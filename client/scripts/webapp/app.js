function ABChoices(spec){this.get=function(){return spec.map(function(test){return[test.name,test.cases[0].name]})},this.getString=function(){return this.get().map(function(choice){return choice.join("=")}).join("&")}}function ngABInterceptor(spec,ABChoices){function elementReplace(data,change){var container=document.createElement("replace-container");return container.innerHTML=data,$(container).find(change.findEle).replaceWith(change.replace),container.innerHTML}function elementSwitch(data,change){var container=document.createElement("replace-container");container.innerHTML=data;var toReplace=$(container).find(change.findEle),children=toReplace.children().detach();return toReplace.replaceWith(change.switchEle).append(children),container.innerHTML}function elementRemove(data,change){var container=document.createElement("replace-container");return container.innerHTML=data,$(container).find(change.removeEle).replaceWith(""),container.innerHTML}var path_mods=spec.reduce(function(pmods,test){function add_changes(change){pmods[change.file]=(pmods[change.file]||[]).concat([change])}return(test.cases[0].changes||[]).map(add_changes),pmods},{});return{response:function(response){function applyChange(data,change){return data+=change.append||"",change.css?data+="<style>"+change.css+"</style>":change.find&&change.replace?data=data.replace(new RegExp(change.find,change.flags),change.replace):change.findEle&&change.replace?data=elementReplace(data,change):change.findEle&&change.switchEle?data=elementSwitch(data,change):change.removeEle?data=elementRemove(data,change):change.replaceAll&&(data=change.replaceAll),data}var mods=path_mods[response.config.url];return mods?(response.data=mods.reduce(applyChange,response.data),response):response}}}function ngABConfig($httpProvider){$httpProvider.interceptors.push("ABInterceptor")}function appConfig($routeProvider,$locationProvider,$httpProvider){$routeProvider.when("/",{templateUrl:"/scripts/home/home.html",reloadOnSearch:!1}).when("/providence",{templateUrl:"/views/providence/providence.html",reloadOnSearch:!1}).when("/test",{templateUrl:"/views/home/home.html",reloadOnSearch:!1}).when("/create",{templateUrl:"/scripts/giftstart/create/giftstart-create.html",reloadOnSearch:!1}).when("/giftstart",{templateUrl:"/scripts/giftstart/giftstart.html",reloadOnSearch:!1}).when("/giftstart/:title",{templateUrl:"/scripts/giftstart/giftstart.html",reloadOnSearch:!1}).when("/giftstart/:title/:object/:attr",{templateUrl:"/scripts/giftstart/giftstart.html",reloadOnSearch:!1}).when("/giftstart/:title/print",{templateUrl:"/scripts/giftstart/print/print.html",reloadOnSearch:!1}).when("/login",{templateUrl:"/scripts/login/login-or-create.html",reloadOnSearch:!1}).when("/users/:uid",{templateUrl:"/scripts/user/user_profile.html",reloadOnSearch:!1}).when("/user/:uid",{templateUrl:"/scripts/user/user_profile.html",reloadOnSearch:!1}).when("/about",{templateUrl:"/scripts/static-pages/about/about.html",reloadOnSearch:!1}).when("/concierge",{templateUrl:"/scripts/static-pages/concierge/concierge.html",reloadOnSearch:!1}).when("/faq",{templateUrl:"/scripts/static-pages/faq/faq.html",reloadOnSearch:!1}).when("/howitworks",{templateUrl:"/scripts/static-pages/howitworks/howitworks.html",reloadOnSearch:!1}).when("/oldbrowser",{templateUrl:"/scripts/static-pages/oldbrowser/oldbrowser.html",reloadOnSearch:!1}).when("/partners",{templateUrl:"/scripts/static-pages/partners/partners.html",reloadOnSearch:!1}).when("/portal",{templateUrl:"/scripts/partnerportal/partnerportal.html",reloadOnSearch:!1}).when("/press",{templateUrl:"/scripts/static-pages/press/press.html",reloadOnSearch:!1}).when("/terms",{templateUrl:"/scripts/static-pages/terms/terms.html",reloadOnSearch:!1}).when("/privacy",{templateUrl:"/scripts/static-pages/privacy/privacy.html",reloadOnSearch:!1}).when("/what-is-it",{templateUrl:"/scripts/static-pages/about/about.html",reloadOnSearch:!1}).when("/add-the-button",{templateUrl:"/scripts/partnerportal/partnerportal.html"}).when("/reset/:resetCode",{templateUrl:"/scripts/home/home.html",reloadOnSearch:!1}).when("/search/:searchTerm",{templateUrl:"/scripts/home/home.html",reloadOnSearch:!1}).when("/search/",{templateUrl:"/scripts/static-pages/giftideas/giftideas.html",reloadOnSearch:!1}).when("/giftideas",{templateUrl:"/scripts/static-pages/giftideas/giftideas.html",reloadOnSearch:!1}).when("/giftideas/:term*",{templateUrl:"/scripts/static-pages/giftideas/giftideas.html",reloadOnSearch:!1}).when("/:path*",{controller:"ContentRouteController",reloadOnSearch:!1,template:'<ng-include ng-show="error" src="\'/scripts/four-oh-four.ng.html\'"></ng-include><div id="wp-content" ng-bind-html="content"></div>'}).otherwise({redirectTo:"/"}),$locationProvider.hashPrefix("!").html5Mode({enabled:!0}),delete $httpProvider.defaults.headers.common["X-Requested-With"]}function facebookConfig(ezfbProvider,$httpProvider){ezfbProvider.setInitParams({appId:window.fbAppId})}function contentRouteController($scope,$routeParams,$http,$sce,$window){function onRouteUpdate(){$scope.content="",$scope.error=!0}$scope.$on("$routeChangeSuccess",onRouteUpdate),onRouteUpdate()}function gsView($timeout){function link(scope,element,attrs){function pathChanged(){$timeout(scrollTop,0)}function scrollTop(){window.scrollTo(0,element[0].offsetTop-9999)}scope.$on("$viewContentLoaded",pathChanged)}return{link:link}}function gsFocus($timeout,$parse){return{link:function(scope,element,attrs){var model=$parse(attrs.gsFocus);scope.$watch(model,function(value){value===!0&&$timeout(function(){element[0].focus()})}),element.bind("blur",function(){console&&console.log&&console.log("blur"),scope.$apply(model.assign(scope,!1))})}}}function gsMenu(UserService,PopoverService){function link(scope,element){function loginChanged(){scope.loggedIn=UserService.loggedIn}function expand(){scope.expanded=!0}function close(){scope.expanded=!1}function login(){PopoverService.setPopover("login")}function logout(){UserService.logout()}device.mobile()||(element.style="display: None"),scope.expanded=!1,scope.loggedIn=UserService.loggedIn,scope.login=login,scope.logout=logout,scope.expand=expand,scope.close=close,scope.$on("logout-success",loginChanged),scope.$on("login-success",loginChanged),scope.$on("menu-open",expand),scope.$on("menu-close",close)}return{restrict:"E",templateUrl:"/scripts/menu/menu.ng.html",link:link}}function gsScrollPlay($window){function link($scope,elm,attrs){window.elm=elm,scope=$scope,element=elm[0],attributes=attrs,padding=attrs.gsPadding,angular.element($window).bind("scroll",onScroll)}function onScroll(){var pxPastTop=$window.innerHeight-element.getBoundingClientRect().top;if(!loaded&&pxPastTop>padding){loaded=!0;var parent=element.parentNode;attributes.$set("src","/assets/howToUseGS.gif"),element.remove(),parent.appendChild(element.cloneNode(!1))}}var scope,element,padding,attributes,loaded=!1;return{restrict:"A",link:link}}function AboutController($scope,$location,$timeout){$scope.location=$location,$scope.scrollToSearch=function(){if(Object.keys($location.search()).length){var selector=document.querySelector("#"+Object.keys($location.search())[0]),element=angular.element(selector);element[0].scrollIntoView()}},$scope.$watch("location.search()",function(){$timeout($scope.scrollToSearch,400),$timeout($scope.scrollToSearch,700)})}function FaqController($scope,$location,$timeout,Analytics){$scope.location=$location,$scope.openQuestions=[];var allOpen=!1;$scope.questionCount=0;var question=function(question,answer){this.question=question,this.answer=answer,$scope.questionCount++},section=function(name,questions){this.name=name,this.questions=questions};$scope.items=[new section("OVERVIEW",[new question("What is GiftStarter?","GiftStarter is a payment parsing service that lets you buy and gift anything that is sold online, piece by piece, at anytime, and with/for whomever you want. We divide anything sold on the internet into a grid, then family and friends buy it tile by tile off the grid. Once complete, we send a handmade card and ensure the gift is shipped, too!"),new question("How does it work?","Search for and select a product using the search bar on the homepage, fill out the GiftStarter Campaign information to share your story on why this is important to you or your gift recipient, and bring others along on the giving journey.  We let your family and friends choose their pieces of the gift to give, we send an awesome hand-crafted group card to remember the experience, and the gift too."),new question("Who can use the GiftStarter service?","Anyone can use the GiftStarter service who has a credit card. We accept payments from most everywhere in the world. Gifts are currently limited to delivery in the United States only for now. Europe and Asia are not available for delivery yet - we are working on it."),new question("What methods of payment do you support?","We accept Visa, Mastercard, American Express, and Discover. We process credit cards using Paypal, and direct payment via PayPal account is coming soon!"),new question("How does GiftStarter compare to other crowdfunding sites?","Other crowdfunding sites focus on enabling payment process. We focus on enabling the gifting experience all the way to delivering a hand-crafted group card and gift."),new question("Where do I go if I need help?",'We are always here to help!  Email us at <a href="mailto:giftconcierge@giftstarter.com">giftconcierge@giftstarter.com</a>.  We are also on standby on <a href="https://twitter.com/GiftStarter">Twitter</a> (@GiftStarter) and <a href="www.facebook.com/giftstart">Facebook</a> (www.facebook.com/giftstart).  Also, feel free to call us at <a href="tel:2064864849">206-486-4849</a>!')]),new section("GIFTSTARTER CAMPAIGNS",[new question("How long will my Giftstarter Campaign be live?","The Gift Champion who creates the gift campaign can decide on how long they want the campaign. You can currently choose from 1 day to 30 days."),new question("What happens if my GiftStarter Campaign isn't completed before the due date?","We send out a giftcard for the amount raised. Depending on the funding level, we will send the recipient a hand-crafted group card with the image of what was intended."),new question("How do I create a successful GiftStarter Campaign?","When you create the GiftStarter Campaign title and description, share with others who will pitch in why it's awesome, why it is the perfect gift for your recipient, and any personal notes about the recipient. Encourage others who pitch in to share their personal stories related to the recipient too! After all, we're creating a gifting memory together!"),new question("When am I charged?","We want to get your contribution to the gift as soon as possible, so we charge your card as soon as you pitch in.")]),new section("GIFTS",[new question("After the GiftStarter Campaign ends, when will the gift arrive?","We will send both the hand-crafted group card (with all those that pitched in and their personal notes) and the gift within 3-5 business days of the GiftStarter Campaign completion."),new question('How is the "base price" determined?','The price of the gift at the time of campaign creation will be used to determine the "base price."'),new question("How do I know who pitched in on the gift?","You'll receive a link to the GiftStarter Campaign once you pitch in. If you're the recipient, you'll receive a hand-crafted gift card at the end of the campaign!")]),new section("SERVICE FEES",[new question("Does GiftStarter have a fee?","Yes, our GiftStarter service fee is 8%."),new question("Who pays the fees?","The 8% service fee is split up among the contributors to the GiftStarter campaign. For example, the fee would be $8.00 for a $100.00 item. And so if you have ten (10) people pitching in, then each person would only pay an additional $0.80. Yes... only 80 cents!! At that point, you could say it's almost free."),new question("Is there a sales tax?","Yes, we have to pay all required legal taxes."),new question("Do I get a receipt?","Yes, as soon as you pitch in, you will receive an email receipt.")]),new section("SECURITY",[new question("Is my credit card information secure?","Security is our top priority. To get specific, our site uses industry standard 128-bit SSL (Secure Sockets Layer) to ensure that sensitive data (ie. credit card number, name, address, etc.) is transmitted securely during every transaction. SSL encrypts the data before it is transmitted so that it can never be read. You will see the SSL seal displayed on the page during checkout and the address bar will change to begin with https."),new question("Is my personal information safe?","We’re sticklers about this. We never share or sell any of the personal information of our registrants or gift-givers.")])],$scope.scrollToSearch=function(){if(Object.keys($location.search()).length){var selector=document.querySelector("#"+Object.keys($location.search())[0]),element=angular.element(selector);element[0].scrollIntoView()}},$scope.$watch("location.search()",function(){$timeout($scope.scrollToSearch,400),$timeout($scope.scrollToSearch,700)}),$scope.toggleQuestion=function(question){$scope.isOpenQuestion(question)?$scope.openQuestions.splice($scope.openQuestions.indexOf(question),1):($scope.openQuestions.push(question),Analytics.track("faq",question.question))},$scope.toggleAll=function(){if(allOpen)$scope.openQuestions.length=0,allOpen=!1;else{for(var sectionIndex=0;sectionIndex<$scope.items.length;sectionIndex++)for(var questionIndex=0;questionIndex<$scope.items[sectionIndex].questions.length;questionIndex++)$scope.openQuestions.push($scope.items[sectionIndex].questions[questionIndex]);allOpen=!0}},$scope.isOpenQuestion=function(question){return-1!=$scope.openQuestions.indexOf(question)}}function GiftideasController($scope,$http,$location,ProductService,UserService){function setMeta(metatitle,metadesc){metatitle="GiftStarter: "+metatitle,$("html head title").text(metatitle),$('html head meta[property="og:title"]').attr("content",metatitle),$("html head meta[name=description]").attr("content",metadesc),$('html head meta[property="og:description"]').attr("content",metadesc)}$scope.productMessage="",$scope.location=$location,$scope.path=$location.path(),$scope.isSavingForLater=!1;var pathParts=$scope.path.replace("//","/").split("/");$scope.basePath=pathParts[1];var category=pathParts.length>2?pathParts[2]:!1;console.log("category: "+category);var product=pathParts.length>3?pathParts[3]:!1;!category||product||"lunarnewyear"!=category&&"farewell"!=category&&"pisces"!=category||"18f05bc479-Weekly_Email_Lunar_New_Year_Pisces_2_19_2015"!=$location.search().utm_campaign||(category=!1),$scope.saveGiftIdeaForLater=function(product){$scope.isSavingForLater=!0;var saver=ProductService.saveForLater("GiftIdeas",product.giftStartLink,parseInt(100*product.productPrice),product.productName,product.productDescription,0==product.productImage.indexOf("http")?product.productImage:"/assets/giftideas/category"+product.productImage);saver?saver.success(function(response){$scope.productMessage="The gift has been saved to your <a href='/users/"+UserService.uid+"'>profile</a>.",$scope.isSavingForLater=!1}).error(function(response){$scope.productMessage="An error occurred while saving the product: "+response.error,$scope.isSavingForLater=!1}):$scope.isSavingForLater=!1},category&&$http({method:"GET",url:"/assets/giftideas/"+category+".json"}).success(function(data){$scope.groups=[],$scope.category=data,$scope.categoryPath=$scope.basePath+"/"+category;var prior=null,setmeta=!1;if(angular.forEach(data.productList,function(value,key){if(value.productNameStripped=String(value.productName).replace(/<[^>]+>/g,"").replace(/&([a-zA-Z0-9#]{2,7});/g,""),value.hasPrice=/^\d.*/.test(value.productPrice),value.productDescription=value.productDescription.replace(/<\/p>\s*(<br\s*\/>)*(<p>\s*&nbsp;\s*<\/p>)*(<br\s*\/>)*\s*<p>/g,"</p><p>"),value.productDescription=value.productDescription.replace(/&quot;/g,'"'),value.productDescription=value.productDescription.replace(/<a /g,'<a target="_new" '),null!=prior?($scope.groups.push([prior,value]),prior=null):prior=value,product&&value.productSlug==product){$scope.product=value;var metatitle=value.productName.replace(/&[a-zA-Z0-9]{1,5};/g,""),metadesc=value.productMetaDescription&&""!=value.productMetaDescription.trim()?value.productMetaDescription:value.productDescription;setMeta(metatitle,metadesc),setmeta=!0}$scope.lastProduct=value}),!setmeta){var metatitle=data.categoryName,metadesc=data.categoryMetaDescription&&""!=data.categoryMetaDescription.trim()?data.categoryMetaDescription:data.categoryBlurb;setMeta(metatitle,metadesc)}null!=prior&&$scope.groups.push([prior])}),$scope.goToLink=function(destination){window.location.href=destination}}function ConciergeController($scope,$http){var resetForm=function(){$scope.email="",$scope.title="",$scope.budget="",$scope.url="",$scope.msg=""};resetForm();var validateForm=function(){var re=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return re.test($scope.email)};$scope.sendMsg=function(){validateForm()?$http.put("/email/contactus.json",{from_email:$scope.email,title:$scope.title,budget:$scope.budget,url:$scope.url}).success(function(res){resetForm(),$scope.msg="Thank you! We'll do our best to respond on the same day, definitely within 24 hours. Please add giftconcierge@giftstarter.com to your address book to make sure you'll receive the reply."}).error(function(res){$scope.msg=res.error}):$scope.msg="Please enter a valid email address."}}function OldbrowserController($scope,$location,$timeout){$scope.location=$location,$scope.scrollToSearch=function(){if(Object.keys($location.search()).length){var selector=document.querySelector("#"+Object.keys($location.search())[0]),element=angular.element(selector);element[0].scrollIntoView()}},$scope.$watch("location.search()",function(){$timeout($scope.scrollToSearch,400),$timeout($scope.scrollToSearch,700)})}function PartnersController($scope,$location,$timeout){$scope.location=$location,$scope.scrollToSearch=function(){if(Object.keys($location.search()).length){var selector=document.querySelector("#"+Object.keys($location.search())[0]),element=angular.element(selector);element[0].scrollIntoView()}},$scope.$watch("location.search()",function(){$timeout($scope.scrollToSearch,400),$timeout($scope.scrollToSearch,700)})}function PressController($scope,$location,$timeout){var pressItem=function(link,img,quote){this.link=link,this.img=img,this.quote=quote};$scope.items=[new pressItem("http://blog.timetrade.com/2015/08/21/wbey-episode-3-amazon-prime-day-giftstarter-top-retail-trends-of-2015/","timetrade.png","GiftStarter.com is a new service promising to help people never give a bad gift again. Instead of finding a cheap gift, or hunting people down who have agreed to go in on group gift, GiftStarter is an online service that allows people to choose a product and pay for it in increments.  Video Link: https://youtu.be/s_XH5fPG9_g"),new pressItem("http://www.bizjournals.com/seattle/print-edition/2015/08/14/friends-help-friends-give-gifts-giftstarter-brings.html","pugetsound.png","Friends help friends give gifts: GiftStarter brings crowdfunding to the party.  How?  GiftStarter lets friends and family collectively buy anything that is sold online.  Meet Arry Yu, CEO.  She's got a gift, and it's in the cloud."),new pressItem("http://www.adamsfinancialconcepts.com/index.php/resources/radio-show?filter_order=a.publish_up&filter_order_Dir=desc&format=html","kkol.png","In 20 years, what will be remembered as the most significant accomplishment of the Obama Administration? What does the future have in store for the stock market? Making group gifting easier and bringing people together, GiftStarter CEO Arry Yu, joins us to her story.  Full radio podcast here: <a href='http://www.adamsfinancialconcepts.com/media/com_podcastmanager/08.14.15_AboutMoney_GiftStarter_ArryYu.mp3'>LINK</a>"),new pressItem("http://simplyathomemom.com/2015/07/27/back-to-school-gift-ideas-with-giftstarter/","simplyathome.png","In minutes, users can launch a campaign for a gift and then GiftStarter does the rest, from helping collect the money to ordering and shipping the gift with a personalized handmade card from all contributors."),new pressItem("http://www.way2goodlife.com/back-to-school-shopping-roundup/","way2goodlife.png","The new school year is getting closer and that means Back to School Shopping. Try GiftStarter.com – this is a group gift solution that makes it easy for family and friends to combine individual budgets and give better, more useful ‪gifts for students in your life."),new pressItem("https://www.yahoo.com/tech/underwater-speakers-instagram-prints-124297324844.html","yahoo.png","Like Kickstarter for gifts: online campaigns to fund pricey presents (for birthdays, weddings, whatever) by dividing their prices up among many givers. The site illustrates who’s contributing what. The gift is shipped with a handmade card."),new pressItem("http://money.usnews.com/money/personal-finance/articles/2015/08/06/5-ways-to-get-a-big-head-start-on-holiday-shopping","usworldnews.png","...websites like GiftStarter.com, where customers can choose the product they want to buy, break the cost into as many pieces as they need and pay at their own pace."),new pressItem("http://issuu.com/arizonahealthandliving/docs/arizona_health_and_living_magazine_/1?e=6323197/14520390","arizonahealthandliving.png","BACK TO SCHOOL can be expensive, especially for college bound students. GiftStarter.com is the ideal solution that makes it easy for family and friends to combine individual budgets to give better more useful gifts to the new college student."),new pressItem("http://www.cpapracticeadvisor.com/news/12100941/giftstarter-platform-brings-cloud-to-gift-giving","cpa.png","A new online cloud service is making gift giving easier. GiftStarter allows family and friends to combine individual budgets to give better gifts to loved ones."),new pressItem("http://www.designcapsule.com/accessories/giftstarter-for-home-decor-gifts/","designcapsulre.png","The next time you want to surprise a loved one with a gift, you may find GiftStarter the best way to purchase a big ticket item."),new pressItem("http://www.seattletimes.com/business/technology/tech-spotlight-giftstarter/","SeattleTimes.png","The gift of efficiency: The site provides the platform for finding the gift, splitting its cost, contacting contributors through social media and processing gift payments. “It really creates that digital event of people coming together in community,” Yu said."),new pressItem("http://www.drugstorenews.com/article/giftstarter-looks-take-hassle-out-gift-giving","drug-store-news.png","The way it works is simple. Users launch a campaign for a gift and then GiftStarter does the rest, from helping collect the money to ordering and shipping the gift with a personalized handmade card from all contributors."),new pressItem("http://www.retailingtoday.com/article/no-more-crappy-gifts-new-site%E2%80%99s-mission","retailing_today.png","The recently launched Web site GiftStarter ... claims to be reinventing the gifting business so that family members, friends and co-workers are able to co-mingle individual budgets to offer recipients a more substantial gift."),new pressItem("http://www.heraldnews.com/article/20150701/BLOGS/307019986","heraldpost.png","That is just the sort of convenience that we always thought the Internet should deliver. And now it does!"),new pressItem("http://blogs.capecodonline.com/cape-cod-gaming/2015/07/01/giftstarter-group-gifting-made-easy/","capecod.png","... the scheme that the folks behind GiftStarter have come up with is not only cool, it is a major problem-solver for giving really great gifts!  The site collects the funds and orders and ships the gift – so all you need to do is pick something that is spectacular and then make sure that the right people know about it!"),new pressItem("http://agbeat.com/lists/5-things-startups-need-to-do-when-trying-to-sign-with-big-name-brands/","americangeniusnews.png","To better navigate the first few sales in signing on major brands and partners, Yu shares her five tips below in her own words.... Whether you’re working with one person or many people, business is about relationships..."),new pressItem("http://www.producthunt.com/tech/giftstarter","producthunt.png","This is awesome. Much better than the person strolling around the office with an envelope and everyone needing change for a $20... It's hard to find good gifts for adults that are inexpensive. I'd typically rather have 15 people buy me 1 thing than 15 different things."),new pressItem("http://www.meetadvisors.com/post/7-keys-to-create-a-healthy-work-environment-for-your-business","meetadvisors_logo.png","GiftStarter: startup with happy employees. Culture is created by each individual within a healthy workplace. We build great teams and have very open communication to make sure that everybody is accountable and happy."),new pressItem("http://www.seattlen.com/n/bbs/board.php?bo_table=News&wr_id=8398","Seattle-Korean-News.png","유씨는 이 같은 소셜 네트워크 방식에서 착안, 누군가에서 여러 사람이 십시일반 정성을 모아 선물을 사주는 벤처기업 (www.giftstarter.com) 을 창업했다고 설명했다."),new pressItem("http://stackeddmagazine.com/2015/04/13/do-the-evolution/","stackedd.png","Both founders of GiftStarter are women, presenting a unique opportunity for Yu’s company to help her employees and partners better understand women’s needs in the workplace."),new pressItem("http://www.geekwire.com/2014/9mile-labs-demo-day-favorite-pitches-products-ideas-seattles-b2b-accelerator/","milestone-9.png","Each entrepreneur had a different story to tell and project to pitch, from group gifting platform GiftStarter to structured note-taking service KustomNote  to draft beer inventory system MetaCraft."),new pressItem("http://www.womenofpresence.com/arry-yu/","women-of-presence.png","People write personal notes with each pitch-in, all of which are compiled into a beautiful handcrafted card to be delivered with the gift, for the gift recipient on the giftstart completion."),new pressItem("http://www.heinzmarketing.com/2014/11/matts-app-week-giftstarter/","heinz.png","Before you know it, the kids are getting that deluxe playset thanks to everyone in the family. It's like Kickstarter, but for gifts. I love it."),new pressItem("http://www.bizjournals.com/seattle/print-edition/2014/09/12/40-under-40-2014-arry-yu.html?page=all","PSBJ.png","Most people don't need more bottles of wine or gift cards. Everyone could pitch in $10 or $15 for something someone really wants. We're putting the giving back into gifting."),new pressItem("http://www.prweb.com/releases/giftstarter/butterlondon/prweb12271758.htm","prweb.png","Powered by GiftStarter, butter LONDON® will be the first beauty brand to give shoppers access to true social gifting of butter LONDON®'s curated gift collections and sets."),new pressItem("http://www.geekwire.com/2014/startup-spotlight-giftstarter-co/","geekwire.png",'The site\'s mission," as Yu explains, "is to bring back the humanity, personality and the joy of real-life interactions, using technology as an enabler - not a focal point.'),new pressItem("http://blog.up.co/2014/11/30/teammates-challenge-got-seattle-startup-top-accelerator/","up-global.png","GiftStarter seems to have gotten it right without losing the spark of that Sunday night pitch back in March - or at least their partner roster would indicate as much.")]}function WhatIsItController($scope,$location,ToastService,$http,Analytics,$window){$scope.hideVideo=Boolean($location.search().hv),$scope.videoWidth="100%",$scope.remindMe=function(){$http({method:"PUT",url:"/users/subscribe.json",data:{email:$scope.email,double_opt_in:!1}}),Analytics.track("client","remind me subscribe"),ToastService.setToast("Awesome!  We'll keep you posted!",7e3)};var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag)}function onYouTubeIframeAPIReady(){player=new YT.Player("player",{videoId:"tA2gcLIJYBU",events:{onStateChange:onPlayerStateChange}})}function onPlayerStateChange(event){event.data==YT.PlayerState.PLAYING?ga("send","event","client","intro-video","play"):event.data==YT.PlayerState.PAUSED?ga("send","event","client","intro-video","pause"):event.data==YT.PlayerState.ENDED&&ga("send","event","client","intro-video","complete")}function stopVideo(){player.stopVideo()}function GiftsGivenBarController($scope){var campaign=function(title,url,img){this.title=title,this.url=url,this.img=img};$scope.campaigns=[new campaign("A fantastic bag for a fantastic lady","https://www.giftstarter.com/giftstart/A-fantastic-bag-for-a-fantastic-lady","https://storage.googleapis.com/giftstarter-pictures/p/58.jpeg"),new campaign("Just when you thought Quinn and Silas' pictures couldn't get any more amazing...","https://www.giftstarter.com/giftstart/Just-when-you-thought-Quinn-and-Silas-pictures-couldnt-get-any-more-amazing","https://storage.googleapis.com/giftstarter-pictures/p/125.jpeg"),new campaign("Agnes Christmas gift","https://www.giftstarter.com/giftstart/Agnes-Christmas-gift","https://storage.googleapis.com/giftstarter-pictures/p/158.jpeg"),new campaign("My inner nerd","https://www.giftstarter.com/giftstart/My-inner-nerd","https://storage.googleapis.com/giftstarter-pictures/p/37.jpeg"),new campaign("Run Nikki Run!!!","https://www.giftstarter.com/giftstart/Run-Nikki-Run","https://storage.googleapis.com/giftstarter-pictures/p/315.jpeg"),new campaign("Let's help Wix move!","https://www.giftstarter.com/giftstart/Lets-help-Wix-move","https://storage.googleapis.com/giftstarter-pictures/p/Lets-help-Wix-move.jpeg"),new campaign("GiftStarter Birthday Campaign for Charity","https://www.giftstarter.com/giftstart/GiftStarter-Birthday-Campaign-for-Charity-2","https://storage.googleapis.com/giftstarter-pictures/p/GiftStarter-Birthday-Campaign-for-Charity-2.jpeg"),new campaign("Jessi's 30th Birthday Blowout!","https://www.giftstarter.com/giftstart/Jessis-30th-Birthday-Blowout","https://storage.googleapis.com/giftstarter-pictures/p/340.jpeg"),new campaign("6 months of seasonal beauty products for Marion's birthday","https://www.giftstarter.com/giftstart/6-months-of-seasonal-beauty-products-for-Marions-birthday","https://storage.googleapis.com/giftstarter-pictures/p/218.jpeg"),new campaign("T1 HIMARS Smoke Break","https://www.giftstarter.com/giftstart/T1-HIMARS-Smoke-Break","https://storage.googleapis.com/giftstarter-pictures/p/165.jpeg"),new campaign("A Place for Piper","https://www.giftstarter.com/giftstart/A-Place-for-Piper","https://storage.googleapis.com/giftstarter-pictures/p/40.jpeg"),new campaign("Andrea and John want a Vitamix for their wedding","https://www.giftstarter.com/giftstart/Andrea-and-John-want-a-Vitamix-for-their-wedding","https://storage.googleapis.com/giftstarter-pictures/p/2.jpg"),new campaign("The Truffle Treasure","https://www.giftstarter.com/giftstart/The-Truffle-Treasure-1","https://storage.googleapis.com/giftstarter-pictures/p/The-Truffle-Treasure-1.jpeg"),new campaign("Spencer's Birthday Gift- Iphone 6!","https://www.giftstarter.com/giftstart/Spencers-Birthday","https://storage.googleapis.com/giftstarter-pictures/p/390.png"),new campaign("Jeffrey Song's Birthday!","https://www.giftstarter.com/giftstart/Jeffrey-Songs-Birthday","https://storage.googleapis.com/giftstarter-pictures/p/Jeffrey-Songs-Birthday.jpeg"),new campaign("Sending our love to our newly minted Texan!","https://www.giftstarter.com/giftstart/Sending-our-love-to-our-newly-minted-Texan","https://storage.googleapis.com/giftstarter-pictures/p/487.jpeg"),new campaign("Birthday Love for Arry","https://www.giftstarter.com/giftstart/Birthday-Love-for-Arry","https://storage.googleapis.com/giftstarter-pictures/p/488.jpeg"),new campaign("Amanda & SoonSol's wedding","https://www.giftstarter.com/giftstart/Amanda--SoonSols-wedding","https://storage.googleapis.com/giftstarter-pictures/p/385.jpeg")];
}function gsThankedCampaigns($http,Analytics){function link(scope,elm,attrs){$scope=scope,$scope.campaigns=[],$http({method:"GET",url:"/giftstarts.json?thanked=true&num="+attrs.gsNum}).success(thankedCampaignsFetched).error(thankedCampaignsFailed)}function thankedCampaignsFetched(data){Analytics.track("client","thanked campaigns fetch success"),$scope.campaigns=data}function thankedCampaignsFailed(reason){console.error("thanked campaigns fetch failed"),Analytics.track("client","thanked campaigns fetch failed")}var $scope;return{link:link,templateUrl:"/scripts/giftstart/thanks/thanked-campaigns.ng.html",restrict:"E"}}function gsPrintUrl($location,$http){function link(scope,element,attrs){var currentUrl=$location.absUrl().slice(0,-5);$http.get("http://api.bitly.com/v3/shorten?callback=",{params:{format:"json",apiKey:"R_85bf9d10211f4423b5c3be4a336ad77d",login:"giftstarter",longUrl:currentUrl}}).success(function(response){element.text(response.data.url),element.wrap("<a href="+response.data.url+"></a>")})}return{link:link,restrict:"E"}}function ToastService($rootScope){this.toastText="Hey this is my toast text!",this.toastMillis=2e3;var self=this;this.getToastText=function(){return self.toastText},this.setToast=function(toastText,toastMillis){self.toastText=toastText,self.toastMillis=toastMillis,$rootScope.$broadcast("display-toast")}}function gsToast(ToastService,$timeout){function link(scope,element,attr){scope.toastText="Het this is my test toast!",scope.hide=!0,scope.displayed=!1,scope.toastP=element[0].children[0].children[0],scope.hideToast=function(){scope.hide=!0,$timeout(scope.displayNoneToast,250)},scope.displayNoneToast=function(){scope.displayed=!1},scope.showToast=function(){scope.hide=!1,scope.displayed=!0},scope.$on("display-toast",function(){scope.toastText=ToastService.getToastText(),scope.toastP.innerHTML=scope.toastText,scope.showToast(),$timeout(scope.hideToast,ToastService.toastMillis)})}return{restrict:"E",templateUrl:"/scripts/utilities/toast.html",link:link}}function AnalyticsService($window,ABChoices,$rootScope,$location){function pathChanged(event){path($location.path())}function path(path){$window.ga&&$window.ga("send","pageview",{page:path})}function track(service,event,label,value){$window.ga&&$window.ga("send","event",service,event,ABChoices.getString(),value,{nonInteraction:1})}this.track=track,this.track("client","loaded"),$rootScope.$on("$viewContentLoaded",pathChanged)}function HeadController($scope,$location){function setMeta(metaObj){var metaEle=headEle.querySelector('meta[property="'+metaObj.property+'"]');metaEle.setAttribute("content",metaObj.content)}var headEle=document.querySelector("head"),ogurlMeta=document.createElement("meta");ogurlMeta.setAttribute("property","og:url"),ogurlMeta.setAttribute("content",$location.absUrl()),headEle.appendChild(ogurlMeta),$scope.ogurl=$location.absUrl(),$scope.$on("$routeUpdate",function(next,current){setMeta({property:"og:url",content:$location.absUrl()})})}function UserService($http,$rootScope,$cookieStore,$window,$timeout,FacebookService,TwitterService,GooglePlusService,emailLoginService,Analytics){function uploadProfileImage(imageData){console&&console.log&&console.log(imageData);var contentType=imageData.split(";")[0].replace("data:","");return $http({method:"PUT",headers:{"Content-Type":contentType},url:"/users/"+self.uid+"/img/new.json",data:{data:imageData}})}function facebookLoggedIn(){Analytics.track("user","logged in with facebook"),self.loginService="facebook",self.registerLogin(FacebookService.uid,FacebookService.usr_img,FacebookService.token,FacebookService.subscribed,FacebookService.name,FacebookService.has_pitched_in)}function twitterLoggedIn(){Analytics.track("user","logged in with twitter"),self.loginService="twitter",self.registerLogin(TwitterService.uid,TwitterService.usr_img,TwitterService.token,TwitterService.subscribed,TwitterService.name,TwitterService.has_pitched_in)}function googleplusLoggedIn(){Analytics.track("user","logged in with googleplus"),self.loginService="googleplus",self.registerLogin(GooglePlusService.uid,GooglePlusService.usr_img,GooglePlusService.token,GooglePlusService.subscribed,GooglePlusService.name,GooglePlusService.has_pitched_in)}function emailLoggedIn(){Analytics.track("user","logged in with email"),self.loginService="emaillogin",self.registerLogin(emailLoginService.uid,emailLoginService.usr_img,emailLoginService.token,emailLoginService.subscribed,emailLoginService.name,emailLoginService.has_pitched_in)}this.uid=-1,this.loggedIn=!1,this.name="",this.profileImageUrl="",this.isStripeCustomer=!1,this.loginService="",this.onMailingList=!1,this.email="",this.referrer={},this.hasPitchedIn=!1;var self=this;this.uploadProfileImage=uploadProfileImage,this.getUser=function(uid,callback){function statFetchSuccess(response){Analytics.track("user","user fetch succeeded"),callback(response)}Analytics.track("user","user fetch initiated"),$http({method:"GET",url:"/users/"+uid+".json"}).success(statFetchSuccess).error(Analytics.track("user","user fetch failed"))},this.isSystemDefaultProfileImage=function(uid,callback){$http({method:"GET",url:"/users/"+uid+".json"}).success(function(data){var u=data[Object.keys(data)[0]];callback(u.is_system_default_profile_image)})},this.registerLogin=function(uid,profileImageUrl,token,onMailingList,name,has_pitched_in){Analytics.track("login",uid),self.uid=uid,self.token=token,self.name=name,self.profileImageUrl=profileImageUrl,self.loggedIn=!0,self.onMailingList=onMailingList,self.hasPitchedIn=has_pitched_in,$rootScope.uid=uid,$rootScope.token=token,$cookieStore.put("uid",uid),$cookieStore.put("token",token),$timeout(function(){$rootScope.$broadcast("login-success")},500),"f"==uid[0]&&FacebookService.getTaggableFriends()},this.logout=function(){"facebook"===self.loginService?FacebookService.logout():"twitter"===self.loginService?TwitterService.logout():"googleplus"===self.loginService?GooglePlusService.logout():"emaillogin"===self.loginService&&emailLoginService.logout(),self.registerLogout()},this.registerLogout=function(){self.loggedIn=!1,self.uid=-1,self.profileImageUrl="",$rootScope.uid=-1,$rootScope.token=-1,$cookieStore.remove("uid"),$cookieStore.remove("token"),$rootScope.$broadcast("logout-success")},this.isUserEmailLogin=function(){return self.loggedIn&&"e"==self.uid.substring(0,1).toLowerCase()},$rootScope.$on("facebook-login-success",facebookLoggedIn),$rootScope.$on("twitter-login-success",twitterLoggedIn),$rootScope.$on("googleplus-login-success",googleplusLoggedIn),$rootScope.$on("email-login-success",emailLoggedIn),$rootScope.$on("facebook-logout-success",self.registerLogout),$rootScope.$on("twitter-logout-success",self.registerLogout),$rootScope.$on("googleplus-logout-success",self.registerLogout),$rootScope.$on("linkedin-logout-success",self.registerLogout),$rootScope.$on("email-logout-success",self.registerLogout),$window.loginDeets&&($window.loginDeets[4]=decodeURIComponent(escape(atob($window.loginDeets[4]))),self.registerLogin.apply(this,$window.loginDeets),self.loginService={f:"facebook",t:"twitter",g:"googleplus",e:"emaillogin"}[$window.loginDeets[0][0]])}function ProfileController($scope,UserService,$location){function imageUpdated(data){$scope.imageSet=!0,imageData=data}function submit(){UserService.uploadProfileImage(imageData).success(function(newImageUrl){$scope.user.img_url=newImageUrl,$scope.editMode=!1}).error(function(reason){console&&console.log&&console.log("Failed to update profile image",reason),$scope.editMode=!1})}$scope.user={};var imageData,urlpath=$location.path(),thisUser=urlpath.substring(urlpath.lastIndexOf("/")+1);UserService.getUser(thisUser,function(data){$scope.user=data[Object.keys(data)[0]]}),$scope.editable=thisUser==UserService.uid,$scope.imageSet=!1,$scope.imageUpdated=imageUpdated,$scope.submit=submit}function InspirationalExamplesController($scope,$timeout){var product=function(image,price,title,product,numPeople,link,desc){this.image=image,this.price=price,this.title=title,this.product=product,this.numPeople=numPeople,this.link=link,this.desc=desc};$scope.products=[new product("/assets/howitworks/featuredCampaigns-julep.jpg","$146.25","6 months of seasonal beauty products for Marion's birthday","6 Boxes of Julep Maven","11","https://www.giftstarter.com/giftstart/6-months-of-seasonal-beauty-products-for-Marions-birthday","/assets/inspirationalexamples/6-months-of-beauty.png"),new product("/assets/howitworks/featuredCampaigns-cigars.jpg","$122.28","T1 HIMARS Smoke Break","Gurkha Special Ops","3","https://www.giftstarter.com/giftstart/T1-HIMARS-Smoke-Break","/assets/inspirationalexamples/t1-himars-smoke-break.png"),new product("/assets/howitworks/featuredCampaigns-tiffanys.jpg","$147.20","Jessi's 30th Birthday Blowout!","TIFFANY 1837™ Circle Pendant","7","https://www.giftstarter.com/giftstart/Jessis-30th-Birthday-Blowout","/assets/inspirationalexamples/jessi-30th-birthday-blowout.png"),new product("/assets/howitworks/featuredCampaigns-ghosttruck.jpg","$448.80","Let's help Wix move!","Gift of Moving by Ghostruck (1br move within 30 mi of Seattle)","15","https://www.giftstarter.com/giftstart/Lets-help-Wix-move","/assets/inspirationalexamples/lets-help-wix-move.png"),new product("/assets/howitworks/featuredCampaigns-lens.jpg","$1,270.08","Just when you thought Quinn and Silas' pictures couldn't get any more amazing...","Canon EF 135mm f/2L USM Lens for Canon SLR Cameras","8","https://www.giftstarter.com/giftstart/Just-when-you-thought-Quinn-and-Silas-pictures-couldnt-get-any-more-amazing","/assets/inspirationalexamples/just-when-you-thought.png"),new product("/assets/howitworks/featuredCampaigns-watch.jpg","$329.52","Run Nikki Run!!!","Garmin Forerunner 220 - Black/Red Bundle (Includes Heart Rate Monitor)","11","https://www.giftstarter.com/giftstart/Run-Nikki-Run","/assets/inspirationalexamples/run-nikki-run.png")];var n=0;$scope.firstProduct=$scope.products[n],$scope.secondProduct=$scope.products[(n+1)%$scope.products.length],$scope.thirdProduct=$scope.products[(n+2)%$scope.products.length];var rotate=function(){jQuery(".product-item.first").fadeOut(1e3,function(){n=(n+1)%$scope.products.length,$scope.$apply(function(){$scope.firstProduct=$scope.products[n]}),jQuery(".product-item.second").fadeOut(1e3,function(){$scope.$apply(function(){$scope.secondProduct=$scope.products[(n+1)%$scope.products.length]}),jQuery(".product-item.third").fadeOut(1e3,function(){$scope.$apply(function(){$scope.thirdProduct=$scope.products[(n+2)%$scope.products.length]}),jQuery(".product-item.third").fadeIn(2e3)})}),jQuery(".product-item.first").fadeIn(2e3),jQuery(".product-item.second").fadeIn(2e3),timer=$timeout(rotate,12e3)})},timer=$timeout(rotate,12e3);$scope.$on("$destroy",function(){$timeout.cancel(timer)})}function FacebookService(ezfb,$http,$rootScope,$location,$window,AppStateService,$q){function getTaggableFriends(){return $q(function(resolve,reject){self.taggableFriends.length?resolve(self.taggableFriends):fetchTaggableFriends(resolve,reject)})}function fetchTaggableFriends(resolve,reject){var uid="me";return $http({method:"GET",url:"https://graph.facebook.com/"+uid+"/taggable_friends?access_token="+window.loginDeets[2]}).success(function(response){self.taggableFriends=response.data,resolve(response.data)}).error(reject)}var self=this;this.uid=-1,this.usr_img="",this.name="",this.token="",this.taggableFriends=[],this.getTaggableFriends=getTaggableFriends,this.loginCallback=function(response){"connected"===response.status&&self.getLongTermToken(response.authResponse.accessToken,response.authResponse.userID)},this.login=function(){AppStateService.set("login_service","facebook");var url="https://www.facebook.com/dialog/oauth?client_id="+window.fbAppId+"&response_type=code&redirect_uri="+$window.location.protocol+"//"+$window.location.host+"&state="+AppStateService.base64State()+"&scope=public_profile,email,user_friends";console&console.log&&console.log("FB URL: "+url)&&console.log("\n\n\n"),$window.open(url,"_self")},this.checkSharePermission=function(){var deferred=$q.defer(),doDeferred=function(){return $http({method:"POST",url:"/users",data:{action:"has-share-auth",service:"facebook"}}).success(function(data){deferred.resolve(data)}).error(function(data){console&&console.log&&console.log(data),deferred.reject(data)}),deferred.promise};return doDeferred()},this.getSharePermissionUrl=function(){AppStateService.set("login_service","facebook");var url="https://www.facebook.com/dialog/oauth?client_id="+window.fbAppId+"&response_type=code&redirect_uri="+$window.location.protocol+"//"+$window.location.host+"&state="+AppStateService.base64StateForSharing()+"&scope=publish_actions";return url},this.doShare=function(message,link,linkName){var deferred=$q.defer(),doDeferred=function(){return $http({method:"POST",url:"/users",data:{action:"do-share",service:"facebook",message:message,link:link,link_name:linkName}}).success(function(data){deferred.resolve(data)}).error(function(data){console&&console.log&&console.log(data),deferred.reject(data)}),deferred.promise};return doDeferred()},this.getLongTermToken=function(token){$http({method:"POST",url:"/users",data:{service:"facebook",action:"get-long-term-token",auth_token:token,location:$location.path()+$window.location.search,referrer:AppStateService.referrer}}).success(function(data){self.uid=data.uid,self.name=data.name,self.usr_img=data.usr_img,self.token=data.token,self.subscribed=data.on_mailing_list,self.has_pitched_in=data.has_pitched_in,$rootScope.$broadcast("facebook-login-success")})},this.logout=function(){$rootScope.$broadcast("facebook-logout-success")},this.inviteFriends=function(uid,method){if($window.FB.Canvas.setAutoGrow(),method="undefined"==typeof method?"send":method,ga(method,"event","share campaign","facebook"),device.mobile()||device.tablet()){var shareUrl="https://www.facebook.com/sharer/sharer.php",parameters="?u="+encodeURIComponent($location.absUrl().split("#")[0]);$window.location.href=shareUrl+parameters}else $location.search("re",btoa(JSON.stringify({type:"consumer",uid:uid,channel:"facebook",uuid:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"==c?r:3&r|8;return v.toString(16)})}))),ezfb.ui({method:method,link:$location.absUrl(),href:$location.absUrl(),app_id:ezfb.app_id}),$location.search("re",null)},AppStateService.fbAuthResponse&&self.getLongTermToken(AppStateService.fbAuthResponse.access_token)}function GiftStartService($http,$location,UserService,$rootScope,PopoverService,$window,Analytics,AppStateService,$resource){function getSelectedParts(){for(var selected=[],i=0;i<self.giftStart.parts.length;i++)self.giftStart.parts[i].selected&&selected.push(i);return selected}function checkForSync(){$http({method:"POST",url:"/pay",data:{action:"get-pitch-ins",gsid:self.giftStart.gsid}}).success(syncCheckCallback).error(function(){console&&console.log&&console.log("Failed to contact part sync.")})}function syncCheckCallback(pitchins){updatePartsFromPitchIns(pitchins),formatPitchIns(pitchins),$rootScope.$broadcast("pitch-ins-updated")}function formatPitchIns(pitchins){newPitchIns=pitchins;var i,len,date;for(i=0,len=newPitchIns.length;len>i;i++)date=new Date(1e3*pitchins[i].timestamp),newPitchIns[i].timestampString=months[date.getMonth()]+" "+date.getDate()+", "+(date.getHours()-1)%12+":"+("0"+date.getMinutes()).slice(-2)+" "+(date.getHours()>=12?"PM":"AM");newPitchIns.sort(function(a,b){return b.timestamp-a.timestamp}),angular.forEach(newPitchIns,function(newPitchIn){self.pitchIns.length<newPitchIns.length&&newPitchIn.gsid===self.giftStart.gsid&&this.unshift(newPitchIn)},self.pitchIns)}function updatePartsFromPitchIns(pitchins){for(var i=0;i<self.giftStart.parts.length;i++)self.giftStart.parts[i].bought=!1,self.giftStart.parts[i].img="",self.giftStart.parts[i].uid="";for(i=0;i<pitchins.length;i++)for(var j=0;j<pitchins[i].parts.length;j++){var partId=pitchins[i].parts[j];self.giftStart.parts[partId].bought=!0,self.giftStart.parts[partId].selected=!1,self.giftStart.parts[partId].img=pitchins[i].img,self.giftStart.parts[partId].uid=pitchins[i].uid}Boolean(self.pitchInsInitialized)||(self.pitchInsInitialized=!0,$rootScope.$broadcast("pitch-ins-initialized")),self.updateSelected()}function updateLastChecked(){self.lastCheckedMilliseconds=(new Date).getTime()}var newPitchIns,months=($resource("/giftstart/:key.json"),["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]);this.giftStart={},this.payment={gsid:-1,parts:[],note:"",stripeResponse:{},emailAddress:"",subscribe:!1,firstName:"",lastName:""},this.pitchIns=[],this.pitchInsInitialized=!1,this.lastCheckedMilliseconds=(new Date).getTime(),this.updateInterval=3e3,this.shippingName="",this.shippingEmail="",this.shippingAddress="",this.shippingCity="",this.shippingState="",this.shippingZip="",this.shippingPhoneNumber="",this.shippingEmail="",this.gcName="",this.gcPhoneNumber="",this.gcEmail="",this.title="",this.description="",this.coupon="",this.specialNotes="",this.productImgUrl="",this.productTitle="",this.retailerLogo="",this.rows=3,this.columns=3,this.productPrice=0,this.salesTax=0,this.shipping=0,this.serviceFee=0,this.totalPrice=0,this.campaignLength=0,this.newPitchIn={},this.thanks_img={},this.preselectedParts=[],AppStateService.get("selectedParts")&&(this.preselectedParts=AppStateService.get("selectedParts"),AppStateService.remove("selectedParts"));var self=this,linkReplacerRegex=/(https?:\/\/(([-\w\.]+)+(:\d+)?(\/([-\w\/_\.]*(\?\S+)?)?)?))/g;this.makeLinks=function(){jQuery(".makelinks").each(function(){var thishtml=jQuery(this).html();thishtml.indexOf("<a")<0&&jQuery(this).html(thishtml.replace(linkReplacerRegex,'<a href="$1" title="" target="_blank">$1</a>'))})},this.createGiftStart=function(){return console&&console.log&&console.log("createGiftStart"),Analytics.track("campaign","created"),self.gcName||(self.gcName=UserService.name),self.giftStart=self.buildGiftStart(),self.pitchInsInitialized=!1,$http({method:"POST",url:"/giftstart/create.json",data:self.giftStart}).success(function(data){self.inflateGiftStart(data)}).error(function(reason){console&&console.log&&console.log(reason),Analytics.track("campaign","campaign create failed")})},this.buildGiftStart=function(){return{title:self.title,description:self.description,coupon:self.coupon,special_notes:self.specialNotes,gift_champion_uid:UserService.uid,product_price:self.productPrice,sales_tax:self.salesTax,shipping:self.shipping,service_fee:self.serviceFee,total_price:self.totalPrice,campaign_length:self.campaignLength,product_img_url:self.productImgUrl,product_url:self.productUrl,product_title:self.productTitle,retailer_logo:self.retailerLogo,totalSelection:0,funded:0,parts:self.makeParts(self.rows*self.columns,self.totalPrice),rows:self.rows,columns:self.columns,gc_phone_number:self.gcPhoneNumber,gc_email:self.gcEmail,gc_name:self.gcName,shipping_name:self.shippingName,shipping_email:self.shippingEmail,shipping_address:self.shippingAddress,shipping_city:self.shippingCity,shipping_state:self.shippingState,shipping_zip:self.shippingZip,shipping_phone_number:self.shippingPhoneNumber}},this.makeParts=function(numParts,totalPrice){function injectPartToggles(parts){function makePartToggle(i){var ti=i;return function(){parts[ti].bought||parts[ti].disabled||(parts[ti].selected=0==parts[ti].selected,Analytics.track("campaign","overlay part toggled"),self.updateSelected())}}for(var i=0;i<parts.length;i++)parts[i].toggle=makePartToggle(i)}for(var tempParts=[],i=0;numParts>i;i++){var selected=self.preselectedParts.indexOf(i)>-1;tempParts.push({bought:!1,disabled:!1,selected:selected,part_id:i,value:Math.floor(totalPrice/numParts)})}return injectPartToggles(tempParts),tempParts},this.disableParts=function(){function disablePart(part){part.disabled=!part.bought}self.giftStart.parts.map(disablePart)},this.updateSelected=function(){self.giftStart.totalSelection=0,self.giftStart.nSelected=0,self.giftStart.nBought=0,self.giftStart.nTotal=0,self.giftStart.remaining=0,self.giftStart.funded=0,self.giftStart.parts.map(function(part){self.giftStart.totalSelection+=part.value*part.selected,self.giftStart.nSelected+=1*part.selected,self.giftStart.nBought+=1*part.bought,self.giftStart.nTotal+=1,self.giftStart.remaining+=part.value*!(part.selected||part.bought),self.giftStart.funded+=part.value*part.bought}),AppStateService.overlayState(getSelectedParts()),$rootScope.$broadcast("selection-changed")},this.fetchGiftStart=function(url_title){console&&console.log&&console.log("fetchGiftStart: "+url_title),$http({method:"GET",url:"/giftstart/"+url_title+".json"}).success(function(data){self.inflateGiftStart(data)}).error(function(){Analytics.track("campaign","campaign fetch failed")})},this.inflateGiftStart=function(giftstart){console&&console.log&&console.log("inflateGiftStart "+giftstart.giftstart_url_title),Analytics.track("campaign","campaign enabled"),self.giftStart=giftstart,self.giftStart.parts=self.makeParts(self.giftStart.rows*self.giftStart.columns,self.giftStart.total_price),self.updateSelected(),/\/giftstart\//.test($location.path())||(console&&console.log&&console.log(location.pathname),$location.path("/giftstart/"+giftstart.giftstart_url_title)),self.syncPitchIns("GiftStartService"),setTimeout(self.makeLinks,2e3),$rootScope.$broadcast("giftstart-loaded")},this.saveNote=function(noteText,name){self.payment.note=noteText,self.payment.firstName=name;var data={payment:self.payment,action:"pitch-in-note-update",uid:UserService.uid};$http({method:"POST",url:"/pay",data:data}).success(function(resp){self.newPitchIn=resp,self.payment.note="",self.payment.firstName="",$rootScope.$broadcast("note-saved")})},this.saveImage=function(imageUrl){var data={payment:self.payment,action:"pitch-in-img-update",uid:UserService.uid,imgurl:imageUrl};return $http({method:"POST",url:"/pay",data:data})},this.uploadImage=function(imageData){var contentType=imageData.split(";")[0].replace("data:",""),data={payment:self.payment,action:"pitch-in-img-upload",uid:UserService.uid,contenttype:contentType,imgdata:imageData};return $http({method:"POST",url:"/pay",data:data})},this.attachStripeResponse=function(response){self.payment.stripeResponse=response,self.payment.gsid=self.giftStart.gsid,self.payment.parts=[];for(var i=0;i<self.giftStart.parts.length;i++)self.giftStart.parts[i].selected&&self.payment.parts.push(self.giftStart.parts[i].part_id)},this.attachCardData=function(number,cvc,expiry,addressZip){self.payment.cardData={number:number,cvc:cvc,expiry:expiry,zip:addressZip},self.payment.gsid=self.giftStart.gsid,self.payment.parts=[];for(var i=0;i<self.giftStart.parts.length;i++)self.giftStart.parts[i].selected&&self.payment.parts.push(self.giftStart.parts[i].part_id)},this.sendPayment=function(callback){var data={payment:self.payment,action:"pitch-in",uid:UserService.uid};self.payment.subscribe&&Analytics.track("pitchin","subscribed to mailing list"),self.payment.saveCreditCard&&Analytics.track("pitchin","save credit card"),$http({method:"POST",url:"/pay",data:data}).success(function(data){self.paymentSuccess(data),callback&&callback(data)}).error(function(data){self.paymentFailure(data),callback&&callback(data)})},this.payWithFingerprint=function(fingerprint){return self.attachStripeResponse(""),$http({method:"POST",url:"/pay",data:{fingerprint:fingerprint,action:"pitch-in",subscribe:self.payment.subscribe,payment:self.payment,uid:UserService.uid}}).success(self.paymentSuccess).error(self.paymentFailure)},this.showOverlay=function(){$rootScope.$broadcast("show-overlay")},this.hideOverlay=function(){$rootScope.$broadcast("hide-overlay")},this.paymentSuccess=function(data){data["payment-error"]||(self.syncPitchIns("GiftStartService"),self.updateSelected(),$rootScope.$broadcast("payment-success"))},this.paymentFailure=function(data){console&&console.log&&console.log("Pitch-in failed!: "+data)},this.updateCampaign=function(newTitle,newDescription,newImage,newGcName){if(newTitle||newDescription||newImage){var newgs={};newTitle&&(newgs.title=newTitle),newDescription&&(newgs.description=newDescription),newImage&&(newgs.image=newImage),newGcName&&(newgs.gc_name=newGcName)}Analytics.track("campaign","campaign update sent"),$http({method:"POST",url:"/giftstart/"+self.giftStart.giftstart_url_title+".json",data:newgs}).success(function(response){Analytics.track("campaign","campaign update succeeded"),response.title&&(self.giftStart.title=response.title),response.description&&(self.giftStart.description=response.description),response.product_img_url&&(self.giftStart.product_img_url=response.product_img_url+"#"+(new Date).getTime()),response.gc_name&&(self.giftStart.gc_name=response.gc_name),$rootScope.$broadcast("giftstart-updated")}).error(function(){Analytics.track("campaign","campaign update failed")})},this.updateComment=function(pitchIn){var data={pitchin:pitchIn,action:"pitch-in-note-update",uid:UserService.uid};$http({method:"POST",url:"/pay",data:data}).success(function(response){Analytics.track("campaign","pitchin comment update succeeded")}).error(function(){Analytics.track("campaign","pitchin comment update failed")})},this.updateCommentImage=function(pitchIn,imageData){var contentType=imageData.split(";")[0].replace("data:",""),data={payment:pitchIn,action:"pitch-in-img-upload",uid:UserService.uid,contenttype:contentType,imgdata:imageData};return $http({method:"POST",url:"/pay",data:data})},this.setThanksImage=function(img){self.thanksImage=img},this.updateThanks=function(message){var url="/thanks";$location.search().thanks&&(url+="-"+$location.search().thanks);var data={message:message,img:self.thanksImage,gsid:self.giftStart.gsid,url_title:self.giftStart.giftstart_url_title};return-1!=UserService.uid&&(data.uid=UserService.uid),$http({method:"PUT",url:url,data:data})},this.goToUserPage=function(uid){$location.path("u").search("").search("uid",uid)},this.syncPitchIns=function(source){console&&console.log&&console.log("syncPitchIns: "+source),self.giftStart.gsid&&("pitch-in-hover"==source||"GiftStartService"==source?(checkForSync(),updateLastChecked()):self.pitchInsInitialized||(checkForSync(),updateLastChecked()))},$rootScope.$on("$routeChangeSuccess",function(){AppStateService.setPath($location.path()),self.pitchInsInitialized=!1;var path=$location.path();if(path.indexOf("/giftstart/")>=0){var urlTitle=path.split("/")[2];void 0!=urlTitle&&self.fetchGiftStart(urlTitle)}}),$window.GIFTSTART&&(self.inflateGiftStart($window.GIFTSTART),$rootScope.$broadcast("giftstart-loaded"))}function GiftStartController($scope,$rootScope,GiftStartService,$location,$interval,$timeout,FacebookService,TwitterService,GooglePlusService,Analytics,ProductService,UserService,AppStateService,$window,$document,$http,PopoverService,LocalStorage){function imageUpdated(data){imageData=data}function restartPitchin(){AppStateService.get("contributeLogin")&&(AppStateService.remove("contributeLogin"),$scope.pitchIn())}function startSecondsLeftTimer(){$scope.secondsLeftTimer=$interval($scope.updateSecondsLeft,1e3)}function loginChanged(){$scope.campaignEditable=UserService.uid==$scope.giftStart.gift_champion_uid}function loggedIn(){$scope.loggedIn=!0,loginChanged()}function loggedOut(){$scope.loggedIn=!1,$scope.showShare=!1,$scope.showShareBox=!1,loginChanged()}Analytics.track("campaign","controller created"),$scope.giftStart=GiftStartService.giftStart,$scope.pitchIns=[],$scope.secondsLeft=0,$scope.newTitle=$scope.giftStart.title,$scope.newDescription=$scope.giftStart.description,$scope.editingTitle=!1,$scope.editingDescription=!1,$scope.campaignEditable=UserService.uid==$scope.giftStart.gift_champion_uid,$scope.pitchInsInitialized=!1,$scope.pitchinButtonHoverMessage="Click on some grid pieces first!",$scope.isMobile=device.mobile(),$scope.newUser=!UserService.hasPitchedIn,$scope.loggedIn=UserService.loggedIn,$scope.imageUpdated=imageUpdated,$scope.picEdit=!1,$scope.picUploading=!1;var currentComment;$scope.userId=UserService.uid,$scope.commentEditing=[];var imageData,commentName,commentImg,commentTxt;if($scope.productMessage="",$scope.isSavingForLater=!1,$scope.showLoginBox=!1,$scope.showPayBox=!1,$scope.showSignBox=!1,$scope.showShareBox=!1,$scope.showShare=UserService.loggedIn&&"share-panel"==$location.hash(),$scope.showSharePanel=function(show){$scope.showShareBox=!1,$scope.showShare=show},$scope.editingComment=function(comment,editing){editing?($scope.commentEditing.push(comment),commentName=comment.name,commentTxt=comment.note,commentImg=comment.img,currentComment=comment):editing||($scope.picEdit=!1,$scope.commentEditing.splice($scope.commentEditing.indexOf(comment),1),GiftStartService.updateComment(comment),currentComment=null)},$scope.cancelEditComment=function(comment){$scope.commentEditing.splice($scope.commentEditing.indexOf(comment),1),comment.name=commentName,comment.note=commentTxt,comment.img=commentImg,$scope.picEdit=!1},$scope.isEditing=function(comment){return-1!=$scope.commentEditing.indexOf(comment)},$scope.picSubmit=function(){$scope.picUploading=!0,imageData&&(currentComment.img=imageData,GiftStartService.updateCommentImage(currentComment,imageData).success(function(response){console&&console.log&&console.log("pitchin image changed"),Analytics.track("campaign","pitchin image update succeeded"),currentComment.img=response,$rootScope.$broadcast("pitchin-image-changed",response),$scope.picUploading=!1,imageData=null;var data={payment:currentComment,action:"pitch-in-img-update",uid:currentComment.uid,imgurl:currentComment.img};$http({method:"POST",url:"/pay",data:data})}).error(function(){Analytics.track("campaign","pitchin image update failed"),$scope.picUploading=!1,imageData=null})),$scope.picEdit=!1},$scope.setPicEdit=function(edit){$scope.picEdit=edit},$scope.getTileCost=function(){return Math.floor($scope.giftStart.total_price/($scope.giftStart.rows*$scope.giftStart.columns))},$rootScope.$on("paybox-hidden",function(){$scope.showPayBox=!1,$scope.showSignBox=!0}),$rootScope.$on("paybox-hidden-cancel",function(){$scope.showPayBox=!1}),$rootScope.$on("signbox-hidden",function(){$scope.showSignBox=!1,$scope.showShare=!1,$scope.showShareBox=!0}),$scope.shareBox=function(show){$scope.showShareBox=show},$scope.giftStart.gc_name?$scope.newGcName=$scope.giftStart.gc_name:$scope.newGcName=UserService.name,$location.search()["gs-id"]&&$location.search("gs-id",null),$scope.mailSubject=encodeURIComponent("Join us on a gift together"),$scope.mailBody=function(){$location.search("re",btoa(JSON.stringify({type:"consumer",uid:UserService.uid,channel:"email",uuid:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"==c?r:3&r|8;return v.toString(16)})})));var url=encodeURIComponent("I thought you might be interested in pitching in on this GiftStarter campaign:\n\n"+$location.absUrl());return $location.search("re",null),url},$location.path().length>11&&void 0==GiftStartService.giftStart.gsid){var url_title=$location.path().split("/")[2];GiftStartService.fetchGiftStart(url_title)}$scope.fundingBarProgress=function(){return(GiftStartService.giftStart.funded/GiftStartService.giftStart.total_price*100).toString()+"%"},$scope.pitchinBarProgress=function(){return((GiftStartService.giftStart.funded+GiftStartService.giftStart.totalSelection)/GiftStartService.giftStart.total_price*100).toString()+"%"},$document.bind("keyup keydown",function(event){return event.ctrlKey&&80===event.keyCode?(window.open("/pdfify?page="+$location.path().slice(1)+"/print"),event.preventDefault(),!1):void 0}),$scope.$on("pitch-ins-initialized",function(){$scope.pitchInsInitialized=!0}),$scope.$on("note-saved",function(){$scope.pitchIns.shift(),$scope.pitchIns.unshift(GiftStartService.newPitchIn)}),$scope.$on("pitch-ins-updated",function(){$http({method:"POST",url:"/pay",data:{action:"get-pitch-ins",gsid:$scope.giftStart.gsid}}).success(function(pitchIns){var currentPids=[];angular.forEach($scope.pitchIns,function(pitchIn){currentPids.unshift(pitchIn.parts.join("_"));
}),angular.forEach(pitchIns,function(pitchIn){currentPids.indexOf(pitchIn.parts.join("_"))<0&&$scope.pitchIns.unshift(pitchIn)})}).error(function(){console&&console.log&&console.log("Failed to contact part sync.")})}),$scope.$on("selection-changed",function(){GiftStartService.giftStart.totalSelection>0?$scope.pitchinButtonHoverMessage="":$scope.pitchinButtonHoverMessage="Click on some parts first!"});var syncPitchInsTimerIsFast=!0,syncPitchInsTimer=$interval(function(){GiftStartService.syncPitchIns("GiftStartService"),syncPitchInsTimerIsFast&&($scope.secondsLeft<=0||$scope.campaignComplete())&&($interval.cancel(syncPitchInsTimer),syncPitchInsTimerIsFast=!1,syncPitchInsTimer=$interval(function(){GiftStartService.syncPitchIns("GiftStartService")},6e4,!1))},1e3,!1);$scope.mouseActivityCallback=function(source){GiftStartService.syncPitchIns(source)},$scope.pitchInHoverCallback=function(){GiftStartService.syncPitchIns("pitch-in-hover")},$scope.pitchIn=function(){GiftStartService.giftStart.totalSelection>0?(Analytics.track("pitchin","pitchin button clicked"),UserService.loggedIn?(AppStateService.set("contributeLogin",!1),$scope.showPayBox=!0,$rootScope.$broadcast("paybox-shown")):(AppStateService.set("contributeLogin",!0),$rootScope.$broadcast("loginbox-show-login"),$scope.showLoginBox=!0)):console&&console.log&&console.log("Nothing selected!")},$scope.campaignComplete=function(){return GiftStartService.giftStart.funded/GiftStartService.giftStart.total_price>.9975},$scope.updateSecondsLeft=function(){if($scope.secondsLeft<0||$scope.campaignComplete())$scope.countdown="Campaign Complete",GiftStartService.disableParts();else{$scope.secondsLeft-=1;var days=Math.floor($scope.secondsLeft/86400).toFixed(0),hours=Math.floor($scope.secondsLeft/3600%24).toFixed(0);$scope.countdown=days+" days, "+hours+" hours"}},$scope.saveProdForLater=function(){$scope.isSavingForLater=!0;var saver=ProductService.saveForLater("GiftStartService",GiftStartService.giftStart.product_url,GiftStartService.giftStart.price,GiftStartService.giftStart.product_title,"",GiftStartService.giftStart.product_img_url);saver?saver.success(function(response){$scope.productMessage="The gift has been saved to your <a href='/users/"+UserService.uid+"'>profile</a>.",$scope.isSavingForLater=!1}).error(function(response){$scope.productMessage="An error occurred while saving the product: "+response.error,$scope.isSavingForLater=!1}):$scope.isSavingForLater=!1};var colorMap=[];$scope.randomColor=function(index){if(null==colorMap[index]){var colors=["red","green","orange","teal"];colorMap[index]=colors[Math.floor(Math.random()*colors.length)]}return colorMap[index]},$scope.campaignUrl=function(){return $location.path().length>11?"http://giftstart.it/g/"+$location.path().slice(11):""},$scope.giftstartThisUrl=function(){return"/create?"+urlSerialize({product_url:GiftStartService.giftStart.product_url,title:GiftStartService.giftStart.product_title,price:GiftStartService.giftStart.price,img_url:GiftStartService.giftStart.product_img_url,source:"GiftStarter"})};var urlSerialize=function(obj){var str=[];for(var p in obj)obj.hasOwnProperty(p)&&str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")};$scope.emailShare=function(){Analytics.track("campaign","email share from campaign"),device.desktop()?PopoverService.setPopover("email-share"):$window.location.href="mailto:?subject="+$scope.mailSubject+"&body="+$scope.mailBody()},$scope.facebookMsg=function(){Analytics.track("campaign","facebook share from campaign"),FacebookService.inviteFriends(UserService.uid)},$scope.facebookShare=function(){Analytics.track("campaign","facebook share from campaign"),FB.ui({method:"share",href:$location.absUrl()},function(response){}),FB.Canvas.setAutoGrow()},$scope.twitterShare=function(){Analytics.track("campaign","twitter share from campaign"),TwitterService.share(UserService.uid)},$scope.googlePlusShare=function(){Analytics.track("campaign","googleplus share from campaign"),GooglePlusService.share(UserService.uid)},$scope.productLinkClicked=function(){Analytics.track("campaign","product link clicked")},$scope.goToUserPage=function(uid){Analytics.track("client","go to user page from comments"),GiftStartService.goToUserPage(uid)},$scope.toPDFPage=function(){window.open("/pdfify?page="+$location.path().slice(1)+"/print")},$scope.$on("login-success",function(){$scope.campaignEditable=UserService.uid===$scope.giftStart.gift_champion_uid,$scope.newUser=!UserService.hasPitchedIn,$scope.showLoginBox=!1,restartPitchin()}),$scope.$on("logout-success",function(){$scope.campaignEditable=UserService.uid===$scope.giftStart.gift_champion_uid}),$scope.showOverlay=GiftStartService.showOverlay,$scope.hideOverlay=GiftStartService.hideOverlay;var imageInput=angular.element(document.getElementById("campaign-image-input"));$scope.updateImage=function(){var maxImageSize=2097152,acceptableFileTypes=["image/jpeg","image/png"];if(imageInput[0].files[0])if(imageInput[0].files[0].size>maxImageSize)alert("Oops!  Images must be smaller than 2 MB.");else if(-1==acceptableFileTypes.indexOf(imageInput[0].files[0].type))alert("Oops!  Only jpeg and png images are allowed!  You chose a "+imageInput[0].files[0].type+".");else{var reader=new FileReader;reader.onload=function(event){var img_data=event.target.result;$scope.newImage={data:img_data,filename:imageInput[0].files[0].name}},reader.readAsDataURL(imageInput[0].files[0])}},$scope.updateCampaign=function(){GiftStartService.updateCampaign($scope.newTitle,$scope.newDescription,$scope.newImage,$scope.newGcName),$scope.editMode=!1},void 0!=GiftStartService.giftStart.gsid&&($scope.secondsLeft=GiftStartService.giftStart.deadline-(new Date).getTime()/1e3,startSecondsLeftTimer()),$scope.$on("giftstart-loaded",function(){$scope.giftStart=GiftStartService.giftStart,$scope.secondsLeft=GiftStartService.giftStart.deadline-(new Date).getTime()/1e3,startSecondsLeftTimer()}),$scope.$on("giftstart-updated",function(){$scope.giftStart=GiftStartService.giftStart,startSecondsLeftTimer()}),$scope.$on("login-success",loggedIn),$scope.$on("logout-success",loggedOut),$scope.$on("giftstart-loaded",restartPitchin),imageInput.bind("change",$scope.updateImage),$scope.$on("$destroy",function(){syncPitchInsTimer&&$interval.cancel(syncPitchInsTimer)})}function gsCopyUrl($window){function link(scope,element,attrs){element.on("click",function(){$window.getSelection().toString()||this.setSelectionRange(0,this.value.length)})}return{restrict:"A",link:link}}function gsThanks(){function controller($scope,UserService,$location,GiftStartService,Analytics,PopoverService,$window,AppStateService){function loginChanged(){thanks.profileImageUrl=UserService.profileImageUrl,thanks.editable=GiftStartService.giftStart.thanks_uid==UserService.uid}function showLogin(){cacheNewMessage(),PopoverService.setPopover("login")}function giftstartChanged(){thanks.message=GiftStartService.giftStart.thanks_message,thanks.newMessage=getNewMessage()||GiftStartService.giftStart.thanks_message,thanks.imgUrl=GiftStartService.giftStart.thanks_img_url,thanks.edit=Boolean(/\/thanks\/edit/.test($location.path())),thanks.editable=$scope.giftStart.thanks_uid==UserService.uid||$location.search().thanks}function cacheNewMessage(){var thisThanksURI="/giftstart/"+GiftStartService.giftStart.giftstart_url_title+"/thanks/edit/";AppStateService.set("thanks-code",$location.search().thanks),localStorage.setItem(thisThanksURI+"message",thanks.newMessage)}function getNewMessage(){var thisThanksURI="/giftstart/"+GiftStartService.giftStart.giftstart_url_title+"/thanks/edit/";return localStorage.getItem(thisThanksURI+"message")}function update(){var req=GiftStartService.updateThanks(thanks.newMessage);req.success(function(response){thanks.message=response.thanks_message,thanks.newMessage=thanks.message,thanks.imgUrl=response.thanks_img_url,$location.path("/giftstart/"+GiftStartService.giftStart.giftstart_url_title)}).error(function(reason){Analytics.track("campaign","thanks failed"),$window.alert("Thanking failed!  Did you get the link right?")}),thanks.edit=!1}function imageUpdated(imageData){GiftStartService.setThanksImage(imageData)}var thanks=this;thanks.message=GiftStartService.giftStart.thanks_message,thanks.newMessage=getNewMessage()||GiftStartService.giftStart.thanks_message,thanks.imgUrl=GiftStartService.giftStart.thanks_img_url,thanks.edit=Boolean(/\/thanks\/edit/.test($location.path())),thanks.editable=$scope.giftStart.thanks_uid==UserService.uid||$location.search().thanks,thanks.showLogin=showLogin,thanks.update=update,thanks.profileImageUrl=UserService.profileImageUrl,thanks.imageUpdated=imageUpdated,void 0==$location.search().thanks&&($location.search("thanks",AppStateService.get("thanks-code")),AppStateService.remove("thanks-code")),$scope.$on("login-success",loginChanged),$scope.$on("logout-success",loginChanged),$scope.$on("giftstart-loaded",giftstartChanged)}return controller.$inject=["$scope","UserService","$location","GiftStartService","Analytics","PopoverService","$window","AppStateService"],{restrict:"E",controller:controller,controllerAs:"thanks",templateUrl:"/scripts/giftstart/thanks/thanks.html"}}function ShareController($scope,$rootScope,GiftStartService,$location,$interval,$timeout,FacebookService,TwitterService,GooglePlusService,LinkedInService,Analytics,ProductService,UserService,AppStateService,$window,$document,$http,PopoverService,LocalStorage){$scope.giftStart=GiftStartService.giftStart,$scope.message="Hey! I just pitched in on a gift for "+$scope.giftStart.shipping_name+" using GiftStarter, a web service where you can buy anything online and split the cost with friends! "+$scope.giftStart.product_title+" will be such an exciting gift for them to receive. Please help to make it happen by following the link below to pitch in too!\n\nLINK: "+$scope.campaignUrl(),$scope.sharePermission=[],$scope.sharePermission.facebook=!1,$scope.sharePermission.twitter=!1,$scope.sharePermission.linkedin=!1,$scope.sharePermission.google=!1;var sharePermissionUrlFacebook=FacebookService.getSharePermissionUrl(),sharePermissionUrlTwitter=null,sharePermissionUrlLinkedIn=LinkedInService.getSharePermissionUrl();$scope.emailRecipients="";var ensuring=[];ensuring.facebook=!1,ensuring.twitter=!1,ensuring.linkedin=!1,$scope.refreshPermissionsStatus=function(){FacebookService.checkSharePermission().then(function(hasPermission){$scope.sharePermission.facebook="1"==hasPermission,ensuring.facebook&&($scope.selectedSocials.facebook=$scope.sharePermission.facebook,ensuring.facebook=!1)}),TwitterService.checkSharePermission().then(function(hasPermission){$scope.sharePermission.twitter="1"==hasPermission,ensuring.twitter&&($scope.selectedSocials.twitter=$scope.sharePermission.twitter,ensuring.twitter=!1)}),LinkedInService.checkSharePermission().then(function(hasPermission){$scope.sharePermission.linkedin="1"==hasPermission,ensuring.linkedin&&($scope.selectedSocials.linkedin=$scope.sharePermission.linkedin,ensuring.linkedin=!1)}),$scope.sharePermission.twitter||TwitterService.getSharePermissionUrl().then(function(url){sharePermissionUrlTwitter=url})},$scope.refreshPermissionsStatus();var permissionsTimer=$interval($scope.refreshPermissionsStatus,24e4);$scope.$on("$destroy",function(){$interval.cancel(permissionsTimer)}),$scope.ensureFacebookSharePermission=function(){ensuring.facebook=!0,window.open(sharePermissionUrlFacebook)},$scope.ensureTwitterSharePermission=function(){ensuring.twitter=!0,window.open(sharePermissionUrlTwitter)},$scope.ensureLinkedInSharePermission=function(){ensuring.linkedin=!0,window.open(sharePermissionUrlLinkedIn)},$scope.shareReset=function(){$scope.selectedSocials.facebook=!1,$scope.selectedSocials.twitter=!1,$scope.selectedSocials.linkedin=!1,$scope.selectedSocials.google=!1,$scope.emailRecipients="",$scope.shareSuccess=!1},$scope.shareFacebook=function(message,link,linkName){Analytics.track("campaign","facebook share submitted"),FacebookService.doShare(message,link,linkName)},$scope.shareTwitter=function(message,link){Analytics.track("campaign","twitter share submitted"),link||(link=$location.absUrl().replace("localhost:8080","www.dev.giftstarter.co")),TwitterService.doShare(message,link)},$scope.shareGplus=function(link){Analytics.track("campaign","gplus share submitted"),link||(link=$location.absUrl().replace("localhost:8080","www.dev.giftstarter.co")),window.open("https://plus.google.com/share?url="+link),$scope.sharePermission.google=!0},$scope.shareLinkedin=function(message,link,linkName){Analytics.track("campaign","linkedin share submitted"),LinkedInService.doShare(message,link,linkName)},$scope.shareEmail=function(to,message,link){link||(link=$location.absUrl().replace("localhost:8080","www.dev.giftstarter.co")),Analytics.track("campaign","email share submitted"),$scope.sending=!0,$http({method:"PUT",url:"/email/sharecampaign.json",data:{to:to,message:message,share_url:link,gsid:$scope.giftStart.gsid}}).success(function(){}).error(function(){})},$scope.shareSuccess=!1,$scope.selectedSocials=[],$scope.selectedSocials.facebook=!1,$scope.selectedSocials.twitter=!1,$scope.selectedSocials.linkedin=!1,$scope.selectedSocials.google=!1;var ensurePermission=[];ensurePermission.facebook=$scope.ensureFacebookSharePermission,ensurePermission.twitter=$scope.ensureTwitterSharePermission,ensurePermission.linkedin=$scope.ensureLinkedInSharePermission,ensurePermission.google=$scope.shareGplus,$scope.shareClick=function(){$scope.shareSuccess=!0,$scope.selectedSocials.facebook&&$scope.shareFacebook($scope.message),$scope.selectedSocials.twitter&&$scope.shareTwitter($scope.message),$scope.selectedSocials.linkedin&&$scope.shareLinkedin($scope.message),$scope.emailRecipients.trim().length>0&&$scope.shareEmail($scope.emailRecipients,$scope.message)},$scope.selectSocial=function(social){$scope.sharePermission[social]?$scope.selectedSocials[social]=!0:ensurePermission[social]()},$scope.campaignUrl=function(){return $location.path().length>11?"http://giftstart.it/g/"+$location.path().slice(11):""},$scope.loggedIn=function(){return UserService.loggedIn}}function ProductService($http,$rootScope,Analytics,UserService,PopoverService,$location){this.product={product_url:"",imgs:[],title:"",logo:"",imageWidth:0,imageHeight:0},this.products=[];var self=this;this.submitLink=function(url,onSuccess,onFail){$http({method:"GET",url:"/products/urls/"+encodeURIComponent(url)+".json"}).success(function(data){data.error?(console&&console.log&&console.log("Fetched failed!"),onFail(data)):(self.product.imgs=data.product.imgs,self.product.price=data.product.price,self.product.title=data.product.title,self.logo=data.product.logo,onSuccess(self.product))}).error(function(data){console&&console.log&&console.log("Fetched failed!"),onFail(data)})},this.createCampaignFromProduct=function(url,price,title,imgUrl){Analytics.track("product","campaign create from search"),self.product.product_url=url,self.product.price=price,self.product.title=title,self.logo="",self.product.imgs=[imgUrl],$location.path("create")},this.saveForLater=function(retailer,url,price,title,description,imgUrl){return UserService.loggedIn?(Analytics.track("product","save for later"),$http.post("/users",{uid:UserService.uid,action:"save-for-later",url:url,retailer:retailer,price:price,title:title,description:description,imgUrl:imgUrl})):void $rootScope.$broadcast("header-show-login")},this.searchProducts=function(search){window.history&&window.history.replaceState({},"GiftStarter Search: "+search,"/search/"+encodeURIComponent(search)),Analytics.track("product","search submitted"),$http({method:"GET",url:"/products/"+encodeURIComponent(search)+".json"}).success(self.fetchSuccess)},this.fetchSuccess=function(result){Analytics.track("product","search succeeded"),self.products=result,self.products.length?$rootScope.$broadcast("products-fetched"):$rootScope.$broadcast("products-empty")}}function gsProductSearch(ProductService,$location,Analytics,UserService,$window,$timeout,$rootScope){function link(scope,element){function onSuccess(product){Analytics.track("product","link submission succeeded"),scope.loading=!1,ProductService.product.product_url=scope.product_url,ProductService.product.imgs=product.imgs,$location.path("create")}function onFailure(reason){Analytics.track("product","link submission failed"),scope.loading=!1,scope.failed=!0}scope.loading=!1,scope.failed=!1,scope.results_empty=!1,scope.product_url="",scope.currentProductLink="",scope.selectedProduct=-1,scope.productMessage="",scope.isSavingForLater=!1,scope.giftConciergeClicked=function(){Analytics.track("client","gift concierge email clicked")},scope.submit=function(){var isUrl=0==scope.product_url.indexOf("http://")|0==scope.product_url.indexOf("https://");isUrl?scope.submitLink():scope.submitSearch()},scope.submitSearch=function(){Analytics.track("product","search submitted"),ProductService.searchProducts(scope.product_url),scope.loading=!0,scope.failed=!1,scope.results_empty=!1,scope.selectedProducts=[]},scope.submitLink=function(){Analytics.track("product","link submitted"),"http://"!==scope.product_url.slice(0,7)&&"https://"!==scope.product_url.slice(0,8)&&(scope.product_url="http://"+scope.product_url),scope.loading=!0,scope.failed=!1,scope.results_empty=!1,ProductService.product.product_url=scope.product_url,ProductService.submitLink(scope.product_url,onSuccess,onFailure)},scope.$on("products-fetched",function(){scope.loading=!1,scope.failed=!1,scope.products=ProductService.products.filter(function(product){return""!=product.imgUrl&&product.price>3998}),scope.pageNumbers=[],scope.numPages=Math.floor(scope.products.length/scope.pageSize);for(var i=1;i<=scope.numPages;i++)scope.pageNumbers.push(i);scope.selectPage(1)}),scope.$on("products-fetch-fail",function(){scope.loading=!1,scope.failed=!0}),scope.$on("products-empty",function(){scope.loading=!1,scope.results_empty=!0}),scope.selectedPage=1,scope.pageSize=10,scope.numPages=0,scope.pageNumbers=[],scope.incrementPage=function(){scope.selectedPage<scope.pageNumbers.length&&(Analytics.track("product","increment page"),scope.selectPage(scope.selectedPage+1))},scope.decrementPage=function(){scope.selectedPage>1&&(Analytics.track("product","decrement page"),scope.selectPage(scope.selectedPage-1))},scope.selectPage=function(page){scope.selectedPage=page,scope.selectedProducts=scope.products.slice((scope.selectedPage-1)*scope.pageSize,scope.selectedPage*scope.pageSize),scope.hideProductDetails(),$("html, body").animate({scrollTop:$("#search-products-section").offset().top-300},200)},scope.showProductDetails=function(index){Analytics.track("product","show product details"),scope.hideProductDetails(),scope.productMessage="",scope.selectedProduct=index,scope.selectedProducts[index].selected=!0;var root=angular.element(document.querySelector("#search-products-section"))[0],height=root.children[index].offsetHeight;$timeout(function(){var offset=root.children[index].offsetTop,scrollOffset=offset-($window.innerHeight-2*height)/2;$window.scrollTo(0,scrollOffset)},100)},scope.hideProductDetails=function(){scope.selectedProduct=-1,scope.selectedProducts.map(function(p){return p.selected=!1,p})},scope.fixImage=function(img){var jImg=$(img);if(jImg.width()<250){var newSrc=jImg.attr("src").replace("500x500","250x250");jImg.attr("src",newSrc),scope.products[jImg.attr("index")].imgUrl=newSrc}},scope.goToProduct=function($index,$event){scope.selectedProduct==$index&&(scope.startCampaignFrom($index),$event.stopPropagation())},scope.startCampaignFrom=function(index){ProductService.createCampaignFromProduct(scope.selectedProducts[index].url,scope.selectedProducts[index].price,scope.selectedProducts[index].title,scope.selectedProducts[index].imgUrl)},scope.saveForLater=function(index){scope.isSavingForLater=!0;var saver=ProductService.saveForLater(scope.selectedProducts[index].retailer,scope.selectedProducts[index].url,scope.selectedProducts[index].price,scope.selectedProducts[index].title,scope.selectedProducts[index].description,scope.selectedProducts[index].imgUrl);saver?saver.success(function(response){scope.productMessage="The gift has been saved to your <a href='/users/"+UserService.uid+"'>profile</a>.",scope.isSavingForLater=!1}).error(function(response){scope.productMessage="An error occurred while saving the product: "+response.error,scope.isSavingForLater=!1}):scope.isSavingForLater=!1};var performHeadSearch=function(){scope.submit(),$("html, body").animate({scrollTop:$("#search-products-section").offset().top-300},200),$window.sessionStorage.setItem("fromSearch",null)};$rootScope.$on("performSearchFromHeader",function(){scope.product_url=$("#product-search-input-head").val(),performHeadSearch()}),$rootScope.$on("performSearchFromUrl",function(){scope.product_url=$window.sessionStorage.getItem("searchTermFromUrl"),performHeadSearch()})}return{restrict:"E",link:link,templateUrl:"/scripts/product/product-search.html"}}function gsOverlay($compile,$timeout,$window,GiftStartService,Analytics){function link(scope,element,attrs){function drawGrid(){$timeout(function(){var overlayHeight=overlayElement.height(),overlayWidth=overlayElement.width();Analytics.track("campaign","overlay drawn");var marginHeight=overlayHeight/GiftStartService.giftStart.rows/20,marginWidth=overlayWidth/GiftStartService.giftStart.columns/20,margin=marginHeight>marginWidth?marginWidth:marginHeight,height=Math.floor(overlayHeight/GiftStartService.giftStart.rows-2*margin),width=Math.floor(overlayWidth/GiftStartService.giftStart.columns-2*margin-1);scope.$on("hide-overlay",function(){angular.element("gs-overlay div.overlay .part-cell").css("opacity","0")}),scope.$on("show-overlay",function(){angular.element("gs-overlay div.overlay .part-cell").css("opacity","1")});var usrHeight=overlayHeight/GiftStartService.giftStart.rows-4*margin,usrWidth=overlayWidth/GiftStartService.giftStart.columns-4*margin,usrShortEdge=usrHeight>usrWidth?usrWidth:usrHeight;if(overlayElement.empty(),"undefined"!==GiftStartService.giftStart.parts&&"undefined"!==GiftStartService.giftStart.parts.length)for(var i=0;i<GiftStartService.giftStart.parts.length;i++){var divString='<div class="part-cell c'+i+'" ng-class="{bought: giftstart.parts['+i+"].bought, selected: giftstart.parts["+i+"].selected, disabled: giftstart.parts["+i+'].disabled}" ng-click="giftstart.parts['+i+'].toggle()" style="width: '+width+"px;height: "+height+"px;margin:"+margin+"px "+margin+'px;"><div class="td"><span class="price">${{giftstart.parts['+i+'].value / 100 | number : 2}}</span><a ng-href="/users/{{giftstart.parts['+i+'].uid}}"><img class="giver" style="width:'+usrShortEdge+"px;height:"+usrShortEdge+'px;" ng-src="{{giftstart.parts['+i+'].img}}"/></a></div></div>';overlayElement.append($compile(divString)(scope))}},10)}var overlayElement=angular.element("gs-overlay div.overlay");drawGrid(),angular.element($window).on("load",drawGrid),angular.element($window).on("resize",drawGrid),scope.$on("overlay-updated",drawGrid),scope.$on("giftstart-loaded",drawGrid)}return{restrict:"E",scope:{giftstart:"="},link:link,templateUrl:"/scripts/giftstart/overlay/overlay.html"}}function PopoverService($rootScope,$timeout,Analytics,LocalStorage){this.template="";var self=this;this.currentLocation="",this.validHashes=["login","pay","note","thanks"],this.setPopover=function(popoverName){console&&console.log&&console.log("setting popover",popoverName),""===popoverName||null===popoverName?this.hidePopover():(self.template="<gs-"+popoverName+"-popover></gs-"+popoverName+"-popover>",self.currentLocation=popoverName,self.showPopover(),$rootScope.$broadcast("popover-updated"))},this.setPopoverFromTemplate=function(newTemplate){this.template=newTemplate,$rootScope.$broadcast("popover-updated")},this.getCurrentTemplate=function(){return this.template},this.hidePopover=function(){$timeout(function(){self.contributeLogin=!1,$rootScope.$broadcast("popover-hidden"),self.currentLocation="",device.mobile()&&olark("api.box.show")})},this.showPopover=function(){device.mobile()&&olark("api.box.hide"),$rootScope.$broadcast("popover-shown")},this.nextPopover=function(){if(self.validHashes.indexOf(self.currentLocation)+1<self.validHashes.length){var nextPopover=self.validHashes[self.validHashes.indexOf(self.currentLocation)+1];self.setPopover(nextPopover),Analytics.track("client","showing popover "+nextPopover)}else self.hidePopover()},self.contributeLogin=Boolean(self.contributeLogin)}function gsPopover(PopoverService,$compile,$document){function link(scope,element,attrs){function popoverUpdated(){currentTemplate=PopoverService.getCurrentTemplate(),templateContainer.empty(),templateContainer.append($compile(currentTemplate)(scope))}function popoverHidden(){scope.popoverShown=!1,bodyElement.removeClass("popoverShown")}function popoverShown(){scope.popoverShown=!0,bodyElement.addClass("popoverShown"),navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&$(window).on("orientationchange",fixPosition),fixPosition()}scope.popoverShown=!1;var templateContainer=angular.element(angular.element(element.children()[0]).children()[0]),currentTemplate="",bodyElement=angular.element($document.find("body")[0]),fixPosition=function(){scope.topPosition=$(window).scrollTop()};scope.topPosition=0,scope.$on("popover-updated",popoverUpdated),scope.$on("popover-hidden",popoverHidden),scope.$on("popover-shown",popoverShown),templateContainer.on("click",function(e){e.stopPropagation()})}return{restrict:"E",link:link,templateUrl:"/scripts/popover/popover.html"}}function gsFundingBar(){function link(scope,element,attrs){}return{restrict:"E",link:link,templateUrl:"/scripts/giftstart/funding-bar/funding-bar.html"}}function LoginPopoverController($scope,$http,$cookieStore,UserService,PopoverService,GiftStartService,TwitterService,FacebookService,$location,GooglePlusService,Analytics,AppStateService,emailLoginService,$routeParams,$timeout){function completeLogin(socialService){switch(Analytics.track("user","login attempt with "+socialService),AppStateService.setPath($location.path()),console&&console.log&&console.log("Setting path",AppStateService.path),socialService){case"facebook":FacebookService.login();break;case"twitter":TwitterService.login();break;case"googleplus":GooglePlusService.login()}}function doLogin(socialService){AppStateService.get("staged_giftstart")?(console&&console.log&&console.log("staged-create: "+AppStateService.get("staged_giftstart").staging_uuid),$http.post("/giftstart/create.json",AppStateService.get("staged_giftstart")).success(function(response){AppStateService.remove("staged_giftstart"),completeLogin(socialService)}).error(function(){console&&console.log&&console.log("Error while staging GiftStart; retrying..."),doLogin(socialService)})):completeLogin(socialService)}function loginComplete(){Analytics.track("user","login succeeded"),/\/create(\/|$)/.test($location.path())?(setTimeout(GiftStartService.createGiftStart,500),setTimeout(PopoverService.hidePopover,2500)):-1!=$location.path().search("giftstart?")&&PopoverService.contributeLogin?(PopoverService.contributeLogin=!1,PopoverService.nextPopover()):PopoverService.hidePopover()}$scope.loggedIn=UserService.loggedIn,$scope.emailFormModel={isLogin:!0,isLoginCreate:!1,isForgotPassword:!1,isEmailLogin:!1,isReset:!1,emailname:"",email:"",emailConfirm:"",password:"",passwordConfirm:"",message:"",loginInProgress:!1,createInProgress:!1,resetInProgress:!1,getPwInProgress:!1,showOk:!1};var mode=$routeParams.resetCode?"reset":"login",loadingComplete=function(){$scope.emailFormModel.loginInProgress=!1,$scope.emailFormModel.getPwInProgress=!1,$scope.emailFormModel.createInProgress=!1,$scope.emailFormModel.resetInProgress=!1},resetForm=function(){$scope.emailLoginForm&&($scope.emailLoginForm.$setPristine(),$scope.emailFormModel.message="")},confirmPasswordCheck=function(){$scope.emailFormModel.password===$scope.emailFormModel.passwordConfirm?$scope.emailLoginForm.$setValidity("confirmPassword",!0):$scope.emailLoginForm.$setValidity("confirmPassword",!1)};$scope.emailFormActions={createLoginMode:function(event){$scope.emailFormModel.isLoginCreate=!0,$scope.emailFormModel.isForgotPassword=!1,$scope.emailFormModel.isLogin=!1,$scope.emailFormModel.isReset=!1,resetForm(),event&&event.preventDefault()},forgotPasswordMode:function(event){$scope.emailFormModel.isLoginCreate=!1,$scope.emailFormModel.isForgotPassword=!0,$scope.emailFormModel.isLogin=!1,$scope.emailFormModel.isReset=!1,resetForm(),event&&event.preventDefault()},loginMode:function(event){$scope.emailFormModel.isLoginCreate=!1,$scope.emailFormModel.isForgotPassword=!1,$scope.emailFormModel.isLogin=!0,$scope.emailFormModel.isReset=!1,resetForm(),event&&event.preventDefault()},resetMode:function(){$scope.emailFormModel.isEmailLogin=!0,$scope.emailFormModel.isLoginCreate=!1,$scope.emailFormModel.isForgotPassword=!1,$scope.emailFormModel.isLogin=!1,$scope.emailFormModel.isReset=!0,resetForm()},submit:function(){$scope.emailLoginForm.$valid&&(AppStateService.setPath($location.path()),emailLoginService.login(mode,$scope.emailFormModel.emailname,$scope.emailFormModel.email,$scope.emailFormModel.password,$routeParams.resetCode).then(function(okMsg){"create"===mode||"reset"===mode?("reset"===mode&&($scope.emailFormModel.message=okMsg),$timeout(function(){$scope.emailFormActions.login(),$scope.emailFormActions.submit(),$scope.emailFormModel.resetInProgress=!1,$scope.emailFormModel.createInProgress=!1},1e3)):"forgotPassword"===mode&&($scope.emailFormModel.message=okMsg,$scope.emailFormModel.showOk=!0),$scope.emailFormModel.loginInProgress=!1,$scope.emailFormModel.getPwInProgress=!1},function(errMsg){$scope.emailFormModel.message=errMsg,loadingComplete()}),console.log("submitting "+mode))},createLogin:function(){Analytics.track("user","create email login"),mode="create",confirmPasswordCheck(),$scope.emailFormModel.email.toLowerCase()===$scope.emailFormModel.emailConfirm.toLowerCase()?$scope.emailLoginForm.$setValidity("confirmEmail",!0):$scope.emailLoginForm.$setValidity("confirmEmail",!1),$scope.emailLoginForm.$valid&&($scope.emailFormModel.createInProgress=!0)},forgotPassword:function(){Analytics.track("user","forgot login password"),mode="forgotPassword",$scope.emailLoginForm.$valid&&($scope.emailFormModel.getPwInProgress=!0)},reset:function(){Analytics.track("user","reset login password"),mode="reset",confirmPasswordCheck(),$scope.emailLoginForm.$valid&&($scope.emailFormModel.resetInProgress=!0)},login:function(){Analytics.track("user","login attempt with email"),mode="login",$scope.emailLoginForm.$valid&&($scope.emailFormModel.loginInProgress=!0)}},"reset"===mode&&$scope.emailFormActions.resetMode(),UserService.loggedIn&&loginComplete(),$scope.facebookLogin=function(){doLogin("facebook")},$scope.twitterLogin=function(){doLogin("twitter")},$scope.googleLogin=function(){doLogin("googleplus")},$scope.hidePopover=PopoverService.hidePopover,TwitterService.getAuthUrl(),$scope.$on("login-success",loginComplete)}function PayPopoverController($scope,$rootScope,GiftStartService,PopoverService,UserService,Analytics,CardService,$timeout){function cardsFetchFailed(){$scope.cardsLoading=!1}function cardsFetched(){$scope.cards=CardService.cards,deselectCards(),$scope.cards.length>0&&$scope.selectCard.apply({card:$scope.cards[0]}),$scope.putNew=!(CardService.cards.length>0),$scope.cardsLoading=!1}function deselectCards(except){$scope.showDeleteCardDialogue=!1,$scope.selectedCard="",$scope.selectedLastFour="";for(var i=0;i<$scope.cards.length;i++)$scope.cards[i].fingerprint!=except&&($scope.cards[i].selected=!1)}$scope.initialize=function(){jQuery(".payment form").find("input[type=text], input[type=email]").val(""),CardService.fetch(),GiftStartService.giftStart.gsid||GiftStartService.createGiftStart(),$scope.currentCharge=GiftStartService.giftStart.totalSelection,$scope.emailSubscribe=!0,$scope.saveCreditCard=!0,$scope.pitchingIn=!1,$scope.userOnMailingList=UserService.onMailingList,$scope.addressZip="",$scope.email="",
$scope.firstname="",$scope.lastname="",UserService.loggedIn&&UserService.getUser(UserService.uid,function(data){var u=data[Object.keys(data)[0]];if($scope.email=u.email,u.name){var names=u.name.split(" ");names.length>0&&($scope.firstname=names[0]),names.length>1&&($scope.lastname=names[names.length-1])}}),$scope.cards=CardService.cards,$scope.putNew=!(CardService.cards.length>0),$scope.showDeleteCardDialogue=!1,$scope.cardsLoading=!(CardService.cards.length>0),$scope.errorMessage="",$scope.submitted=!1,$scope.numberImgUrl="/assets/cc_icon_card_number.png",$scope.cvcImgUrl="/assets/cc_icon_cvc.png",$scope.expiryImgUrl="/assets/cc_icon_expiry.png",$scope.zipImgUrl="/assets/cc_icon_zip.png",$scope.emailImgUrl="/assets/cc_icon_email.png"},$scope.initialize(),$scope.hidePopover=function(){PopoverService.hidePopover(),$scope.submitted?$rootScope.$broadcast("paybox-hidden"):$rootScope.$broadcast("paybox-hidden-cancel")},$rootScope.$on("paybox-shown",$scope.initialize),$scope.updateFormValidity=function(){$scope.submitted&&($scope.numberImgUrl=$scope.stripeForm.$error.card?"/assets/cc_icon_card_number_error.png":"/assets/cc_icon_card_number.png",$scope.cvcImgUrl=$scope.stripeForm.$error.cvc?"/assets/cc_icon_cvc_error.png":"/assets/cc_icon_cvc.png",$scope.expiryImgUrl=$scope.stripeForm.$error.expiry?"/assets/cc_icon_expiry_error.png":"/assets/cc_icon_expiry.png",$scope.zipImgUrl=5!=$scope.addressZip.length?"/assets/cc_icon_zip_error.png":"/assets/cc_icon_zip.png",$scope.emailImgUrl=$scope.stripeForm.$error.email?"/assets/cc_icon_email_error.png":"/assets/cc_icon_email.png")},$scope.trackConversion=function(){var google_conversion_struct={google_conversion_id:961290155,google_conversion_language:"en",google_conversion_format:"2",google_conversion_color:"ffffff",google_conversion_label:"mwFzCO75mlgQq7-wygM",google_conversion_value:GiftStartService.giftStart.totalSelection,google_conversion_currency:"USD",google_remarketing_only:!1};window.google_trackConversion(google_conversion_struct),console&&console.log&&console.log(google_conversion_struct),window.uetq=window.uetq||[];var data={ec:"PitchInThankYou",ea:"PitchInSuccess",el:"PurchaseConfirmation",ev:GiftStartService.giftStart.totalSelection,gv:GiftStartService.giftStart.totalSelection};window.uetq.push(data),console&&console.log&&console.log(data)},$scope.paypalSubmit=function(){$scope.submitted=!0,$scope.pitchingIn=!0,$scope.updateFormValidity(),GiftStartService.payment.subscribe=$scope.emailSubscribe,$scope.selectedCard?GiftStartService.payWithFingerprint($scope.selectedCard).success(function(data){data["payment-error"]?$scope.errorMessage=data["payment-error"]:$scope.trackConversion(),$timeout(function(){$scope.pitchingIn=!1},1e3)}).error(function(data){$scope.pitchingIn=!1,console&&console.log&&console.log(data)}):(Analytics.track("pitchin","payment submitted",GiftStartService.giftStart.gsid.toString(),$scope.currentCharge),GiftStartService.attachCardData($scope.number,$scope.cvc,$scope.expiry,$scope.addressZip),GiftStartService.payment.emailAddress=$scope.email,GiftStartService.payment.firstname=$scope.firstname,GiftStartService.payment.lastname=$scope.lastname,GiftStartService.payment.saveCreditCard=$scope.saveCreditCard,GiftStartService.sendPayment(function(data){data["payment-error"]?$scope.errorMessage=data["payment-error"]:$scope.trackConversion(),$timeout(function(){$scope.pitchingIn=!1},1e3)}))},$scope.stripeSubmit=function(status,response){$scope.submitted=!0,$scope.updateFormValidity(),GiftStartService.payment.subscribe=$scope.emailSubscribe,$scope.selectedCard?GiftStartService.payWithFingerprint($scope.selectedCard).success(function(data){$scope.pitchingIn=!1,data["payment-error"]?(console&&console.log&&console.log(data["payment-error"]),$scope.errorMessage=data["payment-error"]):($scope.trackConversion(),$rootScope.$broadcast("paybox-hidden"))}).error(function(data){$scope.pitchingIn=!1,console&&console.log&&console.log(data)}):response.error?($scope.pitchingIn=!1,console&&console.log&&console.log(response),Analytics.track("pitchin","payment error")):(Analytics.track("pitchin","payment submitted",GiftStartService.giftStart.gsid.toString(),$scope.currentCharge),GiftStartService.attachStripeResponse(response),GiftStartService.payment.emailAddress=$scope.email,GiftStartService.payment.saveCreditCard=$scope.saveCreditCard,GiftStartService.sendPayment(function(data){$scope.pitchingIn=!1,data["payment-error"]?(console&&console.log&&console.log(data["payment-error"]),$scope.errorMessage=data["payment-error"]):($scope.trackConversion(),$rootScope.$broadcast("paybox-hidden"))}))},$scope.$on("payment-success",function(){Analytics.track("pitchin","payment succeeded",GiftStartService.giftStart.gsid.toString(),$scope.currentCharge),$scope.pitchingIn=!1,$rootScope.$broadcast("paybox-hidden"),$scope.number="",$scope.cvc="",$scope.expiry="",$scope.addressZip=""}),$scope.$on("cards-fetch-success",cardsFetched),$scope.$on("cards-fetch-failure",cardsFetchFailed),$scope.deselectCards=deselectCards,$scope.deleteSelectedCard=function(){$scope.showDeleteCardDialogue=!1,$scope.selectedCard&&CardService.deleteCard($scope.selectedCard).success(function(response){CardService.fetch()})},$scope.selectCard=function(allowToggle){this.card.fingerprint==$scope.selectedCard?deselectCards():(deselectCards(this.card.fingerprint),this.card.selected=!0,$scope.selectedCard=this.card.fingerprint,$scope.selectedLastFour=this.card.last_four)}}function cardService($rootScope,$http,UserService,Analytics){function fetchCards(){return-1!=UserService.uid?(Analytics.track("client","user cards fetch started"),$http({method:"GET",url:"/users/"+UserService.uid+"/cards.json"}).success(handleCardResponse).error(function(reason){$rootScope.$broadcast("cards-fetch-failure"),Analytics.track("client","user cards fetch failed")})):void 0}function deleteCard(fingerprint){Analytics.track("client","user card deleted");for(var deleteIndex=-1,i=0;i<this.cards.length;i++)this.cards[i].fingerprint==fingerprint&&(deleteIndex=i);return deleteIndex>=0&&this.cards.splice(deleteIndex,1),$http({method:"POST",url:"/users/"+UserService.uid+"/cards.json",data:{action:"delete-card",fingerprint:fingerprint}})}function addCardImage(card){var newCard=card;return newCard.brandImage=brandImgMap[card.brand],newCard}function handleCardResponse(data){return Analytics.track("client","user cards fetch succeeded"),"string"==typeof data?self.cards=JSON.parse(data).map(addCardImage):self.cards=data.map(addCardImage),$rootScope.$broadcast("cards-fetch-success"),self.cards}var self=this,brandImgMap={Visa:"/assets/visa_card.png",visa:"/assets/visa_card.png","American Express":"/assets/amex_card.png",amex:"/assets/amex_card.png",MasterCard:"/assets/mastercard_card.png",mastercard:"/assets/mastercard_card.png",Discover:"/assets/discover_card.png",discover:"/assets/discover_card.png",JCB:"/assets/jcb_card.png",jcb:"/assets/jcb_card.png","Diners Club":"/assets/dinersclub_card.png",diners:"/assets/dinersclub_card.png",Unknown:"/assets/unknown_card.png",unknown:"/assets/unknown_card.png"};return this.cards=[],this.fetch=fetchCards,this.deleteCard=deleteCard,this}function ThanksPopoverController($scope,PopoverService,GiftStartService,UserService,FacebookService,TwitterService,GooglePlusService,Analytics){$scope.close=function(){PopoverService.hidePopover()},$scope.mailSubject="Join us on a gift together",$scope.mailBody="I thought you might be interested in pitching in on this GiftStarter campaign:%0D%0A%0D%0Ahttp://www.giftstarter.com/giftstart?gs-id="+GiftStartService.giftStart.gsid,$scope.emailShare=function(){Analytics.track("campaign","email share from campaign"),device.desktop()?PopoverService.setPopover("email-share"):$window.location.href="mailto:?subject="+$scope.mailSubject+"&body="+$scope.mailBody()},$scope.facebookMsg=function(){Analytics.track("campaign","facebook share from thanks"),FacebookService.inviteFriends(UserService.uid)},$scope.facebookShare=function(){Analytics.track("campaign","facebook share from thanks"),FB.ui({method:"share",href:$location.absUrl()},function(response){}),FB.Canvas.setAutoGrow()},$scope.twitterShare=function(){Analytics.track("campaign","twitter share from thanks"),TwitterService.share(UserService.uid)},$scope.googlePlusShare=function(){Analytics.track("campaign","googleplus share from thanks"),GooglePlusService.share(UserService.uid)},$scope.hidePopover=PopoverService.hidePopover}function StaffPicksController($scope,$timeout){var product=function(image,price,title,desc,avatar,link){this.image=image,this.price=price,this.title=title,this.desc=desc,this.avatar=avatar,this.link=link};$scope.products=[new product("/assets/staffpicks/4momsBreeze.jpg","$299.99","4moms® Breeze®","This is the one thing I repeatedly wish I would have splurged on. Typical pack and plays are such a pain to set up and take down, I long for the ease of this one every time!","/assets/about/img/christie.png","https://www.giftstarter.com/giftideas/baby/4moms-Breeze-Playard"),new product("/assets/staffpicks/lumixgh4.jpg","$1,497.99","Lumix GH4","It's an amazing video-centric DSLR. The Lumix GH4 shoots 4k at 24p, supports VFR and unlimited length, and boasts clean HDMI out and onboard WiFi & NFC – all at half the price of a Canon 5D!","/assets/about/img/jon.png","https://www.giftstarter.com/search/lumix%20gh4"),new product("/assets/giftideas/category/electronics/apple-watch-milanese.jpg","$699.99","The Apple Watch Milanese","I love all things tech - so I gotta try it! This band is something I would totally wear every day and even out to a dinner party. I bet my husband would steal it and wear it sometimes too.","/assets/about/img/arry.png","https://www.giftstarter.com/giftideas/electronics/Apple-Watch-Milanese"),new product("/assets/staffpicks/hue-personal-wireless-light.jpg","$199.99","Hue Personal Wireless Light","The Philips Hue Personal Wireless Lighting Kit connects to your home Wi-Fi and up to 50 Philips Hue Bulbs/Lighting. It is the most exciting and unique product. The lights sync with an alarm, sets on schedules, and the IFTTT connectivity to other 3rd party apps is mindblowing.","/assets/about/img/roy.png","https://www.giftstarter.com/giftideas/electronics/Hue-Personal-Wireless-Light"),new product("/assets/staffpicks/uppababy-stroller-2015.jpg","$299.99","UPPAbaby Vista Stroller 2015","It’s the only stroller you’ll ever need. First kid? Use the seat, carseat, or bassinet. Two kids? Attach a second of any of those. Three kids? Add the skateboard to the back. It looks right no matter what configuration you have, and it’s full of features.","/assets/about/img/christie.png","https://www.giftstarter.com/giftideas/baby/UPPAbaby-Stroller-2015"),new product("/assets/staffpicks/steelseries-headset-white-thumb.jpg","$159.99","SteelSeries Headphones with Inline Mic","This is a great gift if you need headphones for gaming, streaming, or everyday. It's got inline mic for streaming, looks nice, and is very comfortable.","/assets/about/img/sharon.png","https://www.giftstarter.com/giftideas/electronics/SteelSeries-Headset-White"),new product("/assets/staffpicks/brother-thread-serger.jpg","$299.99","Brother Thread Serger","I have my mother’s old sewing machine, but I find for many of my projects a serger would be ideal. This one is very user friendly for novices, with advanced features for experienced users.","/assets/about/img/christie.png","https://www.giftstarter.com/giftideas/forher/Brother-Thread-Serger"),new product("/assets/staffpicks/guava-lotus-everywhere-crib.jpg","$509.00","Lotus Everywhere Crib","Transforms from backpack to standard-size crib in under a minute. Lightweight yet stable, with zippered mesh sides and an optional sun-shade, it's perfect for travel AND as a primary sleep-space or play area for your little one.","/assets/about/img/jon.png","https://www.giftstarter.com/giftideas/baby/Guava-Lotus-Everywhere-Crib"),new product("/assets/staffpicks/deathadder-gaming-mouse-thumb.jpg","$59.99","Razer Gaming Mouse","This is the ultimate mouse for gaming and everyday use and it's ergonomic, too!!","/assets/about/img/sharon.png","https://www.giftstarter.com/giftideas/electronics/DeathAdder-Gaming-Mouse")];var n=0;$scope.firstProduct=$scope.products[n],$scope.secondProduct=$scope.products[(n+1)%$scope.products.length];var rotate=function(){jQuery(".product-item.first").fadeOut(500,function(){n=(n+1)%$scope.products.length,$scope.$apply(function(){$scope.firstProduct=$scope.products[n]}),jQuery(".product-item.second").fadeOut(500,function(){$scope.$apply(function(){$scope.secondProduct=$scope.products[(n+1)%$scope.products.length]})}),jQuery(".product-item.first").fadeIn(1e3),jQuery(".product-item.second").fadeIn(1e3),timer=$timeout(rotate,2e4)})},timer=$timeout(rotate,2e4);$scope.$on("$destroy",function(){$timeout.cancel(timer)})}function gsImageUpload($timeout,$window){function link(scope,element,attrs){function resizeCanvas(){canvasEle.width=2*gsElement.parentElement.offsetWidth,aspect?canvasEle.height=2*gsElement.offsetWidth/aspect:canvasEle.height=2*gsElement.offsetHeight}function makeImage(imageData){resizeCanvas();var tempImg=new Image;tempImg.src=imageData,tempImg.onload=function(){var imageW=tempImg.width,imageH=tempImg.height,rotation=0;imageW>imageH?(imageW*=canvasEle.width/imageH,imageH=canvasEle.height):(imageH*=canvasEle.height/imageW,imageW=canvasEle.width);var imageContext=this;ctx.drawImage(this,0,0,imageW,imageH),scope.imageUpdated(canvasEle.toDataURL()),scope.rotateImage=function(){ctx.translate(canvasEle.width/2,canvasEle.height/2),rotation=(rotation+1)%4,ctx.rotate(Math.PI/2),ctx.translate(-canvasEle.width/2,-canvasEle.height/2),ctx.drawImage(imageContext,imgX,imgY,imageW,imageH),scope.imageUpdated(canvasEle.toDataURL())};var dragReady=!0,dragPrevX=0,dragPrevY=0,imgX=0,imgY=0,dragNextX=0,dragNextY=0,dragging=!1;angular.element(canvasEle).on("mousedown touchstart",function(event){dragReady&&(dragReady=!1,$timeout(function(){dragReady=!0},100),dragging=!0,dragPrevX=event.screenX||event.touches.item(0).screenX,dragNextX=dragPrevX,dragPrevY=event.screenY||event.touches.item(0).screenY,dragNextY=dragPrevY)}),angular.element(canvasEle).on("mouseup touchend mouseleave touchleave",function(event){dragging=!1,scope.imageUpdated(canvasEle.toDataURL())}),angular.element(canvasEle).on("mousemove touchmove",function(event){if(dragging){switch(event.preventDefault(),rotation){case 0:imgX+=dragNextX-dragPrevX,imgY+=dragNextY-dragPrevY;break;case 1:imageW>imageH?(imgX+=dragNextY-dragPrevY,imgY+=dragNextX-dragPrevX):(imgX-=dragNextY-dragPrevY,imgY-=dragNextX-dragPrevX);break;case 2:imgX-=dragNextX-dragPrevX,imgY-=dragNextY-dragPrevY;break;case 3:imageW>imageH?(imgX-=dragNextY-dragPrevY,imgY-=dragNextX-dragPrevX):(imgX+=dragNextY-dragPrevY,imgY+=dragNextX-dragPrevX)}dragPrevX=dragNextX,dragNextX=event.screenX||event.touches.item(0).screenX,dragPrevY=dragNextY,dragNextY=event.screenY||event.touches.item(0).screenY,imgX>0&&(imgX=0),imgY>0&&(imgY=0),imageH+imgY<canvasEle.height&&(imgY=canvasEle.height-imageH,dragPrevY=dragNextY),imageW+imgX<canvasEle.width&&(imgX=canvasEle.width-imageW,dragPrevX=dragNextX),ctx.drawImage(imageContext,imgX,imgY,imageW,imageH)}})}}function fileLoaded(){try{$window.localStorage.setItem("thank-you-image",reader.result)}catch(exception){console&&console.log&&console.log("Unable to store image in localStorage",exception)}makeImage(reader.result),scope.$parent.imgloading=!1}function fileChanged(){scope.putImage(inputEle.files[0])}var inputEle=document.querySelector(".thanks-image-input"),canvasEle=element.children()[0].children[0],ctx=canvasEle.getContext("2d"),aspect=attrs.aspect,gsElement=element[0];scope.openImageDialog=function(){inputEle.click()},scope.$parent.openImageDialogGlobal=function(){scope.openImageDialog()},resizeCanvas(),$window.localStorage.getItem("thank-you-image")&&(reader={result:$window.localStorage.getItem("thank-you-image")},$window.localStorage.removeItem("thank-you-image"),makeImage(reader.result));var reader;scope.putImage=function(file){reader=new FileReader,reader.onloadend=fileLoaded,reader.readAsDataURL(file)},angular.element(inputEle).on("change",function(){scope.$parent.imgloading=!0,$timeout(function(){fileChanged()},100)})}return{restrict:"E",scope:{imageUpdated:"=onImageUpdated",imageData:"=newImageData"},link:link,templateUrl:"/scripts/utilities/image-upload/image-upload.html"}}function LocalStorage($window){function set(key,data){var item=data;"string"!=typeof data&&(item=JSON.stringify(data)),$window.localStorage.setItem(key,item)}function get(key){var item=$window.localStorage.getItem(key);try{item=JSON.parse(item)}catch(e){}return item}function remove(key){$window.localStorage.removeItem(key)}this.set=set,this.get=get,this.remove=remove}function gsItButton(GiftStartService){function link(scope,ele,attrs){var anchor=ele[0].children[0].children[0];anchor.href=calculateLink()}function calculateLink(){return console&&console.log&&console.log(GiftStartService.giftStart),url="/create?"+urlSerialize({product_url:GiftStartService.giftStart.product_url,title:GiftStartService.giftStart.product_title,price:GiftStartService.giftStart.price,img_url:GiftStartService.giftStart.product_img_url,source:"GiftStarter"})}var urlSerialize=function(obj){var str=[];for(var p in obj)obj.hasOwnProperty(p)&&str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")};return{restrict:"E",link:link,templateUrl:"/scripts/button/giftstart-it-button.ng.html"}}function gsItHeader($interval,$window,$location,Analytics){function link(scope,ele,attr){function hideButtonHeader(){$scope.shown=!1}function showButtonHeader(){$scope.shown=!0}function onScroll(){shown||200<($window.scrollY||$window.scrollTop)&&(shown=!0,showButtonHeader())}function linkClicked(){Analytics.track("client","giftstart it header button clicked")}$scope=scope,$scope.hideButtonHeader=hideButtonHeader,$scope.linkClicked=linkClicked,scope.$on("$routeChangeStart",hideButtonHeader),$interval(onScroll,2e3)}var $scope,shown=0!=$location.path().indexOf("/giftstart");return{scope:$scope,restrict:"E",link:link,templateUrl:"/scripts/header/giftstart-it-header.ng.html"}}function gsSubscribeHeader($location,Analytics,$timeout,UserService){function link(scope,ele,attr){function hideHeader(){$scope.subscribeShow=!1}function showHeader(){$scope.subscribeShow=!0}function subscribeClicked(){Analytics.track("client","header email subscribed")}$scope=scope,$scope.subscribeShow=!0,$scope.hideSubscribeHeader=hideHeader,$scope.subscribeClicked=subscribeClicked,$timeout(function(){show&&(showHeader(),show=!1)},1500)}var $scope,show=-1==$location.path().indexOf("/giftstart")&&!UserService.onMailingList;return{scope:$scope,restrict:"E",link:link,templateUrl:"/scripts/header/subscribe-header.ng.html"}}var gsAngulartics=angular.module("gsAngulartics",["angulartics","angulartics.segment","angulartics.inspectlet","angulartics.google.tagmanager"]).config(function($analyticsProvider){$analyticsProvider.firstPageview(!0),$analyticsProvider.withAutoBase(!0),$analyticsProvider.withBase(!0)}),ngAB=angular.module("ngAB",[]).value("spec",{});ngAB.service("ABChoices",["spec",ABChoices]),ngAB.factory("ABInterceptor",["spec","ABChoices",ngABInterceptor]),ngAB.config(["$httpProvider",ngABConfig]),function(root,factory){"use strict";"function"==typeof define&&define.amd?define([],factory):"object"==typeof exports?module.exports=factory():root.viewportUnitsBuggyfill=factory()}(this,function(){"use strict";function debounce(func,wait){var timeout;return function(){var context=this,args=arguments,callback=function(){func.apply(context,args)};clearTimeout(timeout),timeout=setTimeout(callback,wait)}}function inIframe(){try{return window.self!==window.top}catch(e){return!0}}function initialize(initOptions){initialized||(initOptions===!0&&(initOptions={force:!0}),options=initOptions||{},options.isMobileSafari=isMobileSafari,options.isBadStockAndroid=isBadStockAndroid,(options.force||isMobileSafari||isOldInternetExplorer||isBadStockAndroid||isOperaMini||options.hacks&&options.hacks.required(options))&&(options.hacks&&options.hacks.initialize(options),initialized=!0,styleNode=document.createElement("style"),styleNode.id="patched-viewport",document.head.appendChild(styleNode),importCrossOriginLinks(function(){var _refresh=debounce(refresh,options.refreshDebounceWait||100);window.addEventListener("orientationchange",_refresh,!0),window.addEventListener("pageshow",_refresh,!0),(options.force||isOldInternetExplorer||inIframe())&&(window.addEventListener("resize",_refresh,!0),options._listeningToResize=!0),options.hacks&&options.hacks.initializeEvents(options,refresh,_refresh),refresh()})))}function updateStyles(){styleNode.textContent=getReplacedViewportUnits(),styleNode.parentNode.appendChild(styleNode)}function refresh(){initialized&&(findProperties(),setTimeout(function(){updateStyles()},1))}function findProperties(){return declarations=[],forEach.call(document.styleSheets,function(sheet){"patched-viewport"!==sheet.ownerNode.id&&sheet.cssRules&&"ignore"!==sheet.ownerNode.getAttribute("data-viewport-units-buggyfill")&&(sheet.media&&sheet.media.mediaText&&window.matchMedia&&!window.matchMedia(sheet.media.mediaText).matches||forEach.call(sheet.cssRules,findDeclarations))}),declarations}function findDeclarations(rule){if(7===rule.type){var value;try{value=rule.cssText}catch(e){return}return viewportUnitExpression.lastIndex=0,void(viewportUnitExpression.test(value)&&(declarations.push([rule,null,value]),options.hacks&&options.hacks.findDeclarations(declarations,rule,null,value)))}if(!rule.style){if(!rule.cssRules)return;return void forEach.call(rule.cssRules,function(_rule){findDeclarations(_rule)})}forEach.call(rule.style,function(name){var value=rule.style.getPropertyValue(name);rule.style.getPropertyPriority(name)&&(value+=" !important"),viewportUnitExpression.lastIndex=0,viewportUnitExpression.test(value)&&(declarations.push([rule,name,value]),options.hacks&&options.hacks.findDeclarations(declarations,rule,name,value))})}function getReplacedViewportUnits(){dimensions=getViewport();var open,close,css=[],buffer=[];return declarations.forEach(function(item){var _item=overwriteDeclaration.apply(null,item),_open=_item.selector.length?_item.selector.join(" {\n")+" {\n":"",_close=new Array(_item.selector.length+1).join("\n}");return _open&&_open===open?(_open&&!open&&(open=_open,close=_close),void buffer.push(_item.content)):(buffer.length&&(css.push(open+buffer.join("\n")+close),buffer.length=0),void(_open?(open=_open,close=_close,buffer.push(_item.content)):(css.push(_item.content),open=null,close=null)))}),buffer.length&&css.push(open+buffer.join("\n")+close),isOperaMini&&css.push("* { content: normal !important; }"),css.join("\n\n")}function overwriteDeclaration(rule,name,value){var _value,_selectors=[];_value=value.replace(viewportUnitExpression,replaceValues),options.hacks&&(_value=options.hacks.overwriteDeclaration(rule,name,_value)),name&&(_selectors.push(rule.selectorText),_value=name+": "+_value+";");for(var _rule=rule.parentRule;_rule;)_selectors.unshift("@media "+_rule.media.mediaText),_rule=_rule.parentRule;return{selector:_selectors,content:_value}}function replaceValues(match,number,unit){var _base=dimensions[unit],_number=parseFloat(number)/100;return _number*_base+"px"}function getViewport(){var vh=window.innerHeight,vw=window.innerWidth;return{vh:vh,vw:vw,vmax:Math.max(vw,vh),vmin:Math.min(vw,vh)}}function importCrossOriginLinks(next){var _waiting=0,decrease=function(){_waiting--,_waiting||next()};forEach.call(document.styleSheets,function(sheet){sheet.href&&origin(sheet.href)!==origin(location.href)&&(_waiting++,convertLinkToStyle(sheet.ownerNode,decrease))}),_waiting||next()}function origin(url){return url.slice(0,url.indexOf("/",url.indexOf("://")+3))}function convertLinkToStyle(link,next){getCors(link.href,function(){var style=document.createElement("style");style.media=link.media,style.setAttribute("data-href",link.href),style.textContent=this.responseText,link.parentNode.replaceChild(style,link),next()},next)}function getCors(url,success,error){var xhr=new XMLHttpRequest;if("withCredentials"in xhr)xhr.open("GET",url,!0);else{if("undefined"==typeof XDomainRequest)throw new Error("cross-domain XHR not supported");xhr=new XDomainRequest,xhr.open("GET",url)}return xhr.onload=success,xhr.onerror=error,xhr.send(),xhr}var options,dimensions,declarations,styleNode,initialized=!1,userAgent=window.navigator.userAgent,viewportUnitExpression=/([+-]?[0-9.]+)(vh|vw|vmin|vmax)/g,forEach=[].forEach,isOldInternetExplorer=!1,isOperaMini=userAgent.indexOf("Opera Mini")>-1,isMobileSafari=/(iPhone|iPod|iPad).+AppleWebKit/i.test(userAgent)&&function(){var iOSversion=userAgent.match(/OS (\d)/);return iOSversion&&iOSversion.length>1&&parseInt(iOSversion[1])<8}(),isBadStockAndroid=function(){var isAndroid=userAgent.indexOf(" Android ")>-1;if(!isAndroid)return!1;var isStockAndroid=userAgent.indexOf("Version/")>-1;if(!isStockAndroid)return!1;var versionNumber=parseFloat((userAgent.match("Android ([0-9.]+)")||[])[1]);return 4.4>=versionNumber}();return isOldInternetExplorer||(isOldInternetExplorer=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)),{version:"0.5.1",findProperties:findProperties,getCss:getReplacedViewportUnits,init:initialize,refresh:refresh}});var GiftStarterApp=angular.module("GiftStarterApp",["ngRoute","ezfb","angularPayments","ngCookies","ngTouch","ngSanitize","ngAB","ngResource","ui.date"]);angular.module("GiftStarterApp").service("AppStateService",["$location","$window","$rootScope",function($location,$window,$rootScope){function set(key,value){state[key]=value}function get(key){return state[key]}function remove(key){delete state[key]}function getOauthRedirectUrl(){return $window.location.protocol+"//"+$window.location.host+"/?state="+self.base64State()}function getOauthRedirectUrlForSharing(){return $window.location.protocol+"//"+$window.location.host+"/?state="+self.base64State(!0)}function base64StateForSharing(){return base64State(!0)}function base64State(isSharingLogin){return state.path=window.location.pathname,""!=window.location.hash&&"#"!=window.location.hash&&(state.hash=window.location.hash.slice(1)),state.app_url=$window.location.protocol+"//"+$window.location.host+"/",state.is_sharing_login=isSharingLogin?1:0,state.prior_uid=$rootScope.uid,state.prior_token=$rootScope.token,console&&console.log&&console.log("encoding state",state),btoa(JSON.stringify(state))}function overlayState(selectedParts){set("selectedParts",selectedParts)}function thanksState(thanksData){set("thanks",thanksData)}var self=this,state={};this.set=set,this.get=get,this.remove=remove,this.base64State=base64State,this.base64StateForSharing=base64StateForSharing,this.getOauthRedirectUrl=getOauthRedirectUrl,this.getOauthRedirectUrlForSharing=getOauthRedirectUrlForSharing,this.overlayState=overlayState,this.thanksState=thanksState,this.path=$location.path(),$location.search("code",null),$location.search("oauth_verifier",null),$location.search("oauth_token",null),$location.search("authuser",null),$location.search("num_sessions",null),$location.search("session_state",null),$location.search("prompt",null),"_=_"==$location.hash()&&$location.hash(""),this.setPath=function(path){self.path=path},$location.search().state&&(state=JSON.parse($window.atob($location.search().state)),console&&console.log&&console.log("parsed state",state),$location.search("state",null),state.title_url?$location.path("/giftstart/"+state.title_url):state.path&&($location.path(state.path),state.hash&&$location.hash(state.hash)),$rootScope.$broadcast("state-parsed")),$location.search().code&&$location.search().session_state&&$location.search().authuser?(self.gplusAuthResponse=function(a){if(""==a)return{};for(var b={},i=0;i<a.length;++i){var p=a[i].split("=");2==p.length&&(b[p[0]]=decodeURIComponent(p[1].replace(/\+/g," ")))}return b}($window.location.search.substr(1).split("&")),$location.search("code",null),$location.search("session_state",null),$location.search("authuser",null),$location.search("num_sessions",null),$location.search("prompt",null)):/access_token/.test($location.hash())&&(self.fbAuthResponse=function(a){if(""==a)return{};for(var b={},i=0;i<a.length;++i){var p=a[i].split("=");2==p.length&&(b[p[0]]=decodeURIComponent(p[1].replace(/\+/g," ")))}return b}($location.hash().split("&")),$location.hash("")),$location.search().re&&(set("referrer",JSON.parse(atob($location.search().re))),$location.search("re",null)),$location.search().public_key&&(set("api_key",$location.search().public_key),$location.search("public_key",null)),$location.search().source&&$location.search().title&&$location.search().product_url&&(set("referrer",{type:"partner",channel:$location.search().source.replace("shopify/",""),uuid:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"==c?r:3&r|8;return v.toString(16)})}),this.giftstartReferralData=$location.search())}]),GiftStarterApp.config(["$routeProvider","$locationProvider","$httpProvider",appConfig]),GiftStarterApp.config(["ezfbProvider","$httpProvider",facebookConfig]),GiftStarterApp.controller("ContentRouteController",contentRouteController),GiftStarterApp.directive("gsView",["$timeout",gsView]),GiftStarterApp.directive("gsFocus",gsFocus),setTimeout(function(){angular.module("GiftStarterApp").directive("gsMenu",gsMenu)},0),setTimeout(function(){null===document.getElementById("angular-view")&&window.location.reload()},3e3),angular.module("GiftStarterApp").directive("gsScrollPlay",["$window",gsScrollPlay]),GiftStarterApp.controller("AboutController",["$scope","$location","$timeout",AboutController]),GiftStarterApp.controller("FaqController",["$scope","$location","$timeout","Analytics",FaqController]),GiftStarterApp.controller("GiftideasController",["$scope","$http","$location","ProductService","UserService",GiftideasController]),GiftStarterApp.controller("ConciergeController",["$scope","$http",ConciergeController]),function(app){var HowItWorksController=function($scope,$location){$scope.location=$location,$scope.sectionShown="welcome"};app.controller("HowItWorksController",["$scope","$location",HowItWorksController])}(angular.module("GiftStarterApp")),GiftStarterApp.controller("OldbrowserController",["$scope","$location","$timeout",OldbrowserController]),function(app){var PartnerportalController=function($scope,$rootScope,$window,UserService,$timeout,$location,$http,Analytics){function loadCoreData(){$scope.loading=!0,$http({method:"GET",url:"/users/partner/"+UserService.uid+".json"}).success(function(response){$scope.coreDataComplete=!1,$scope.editMode=!0,$scope.partner=response,$scope.partner.api_key&&$scope.partner.api_key.length>0&&($scope.coreDataComplete=!0,$scope.editMode=!1),$scope.coreError="",$scope.loading=!1}).error(function(){$scope.coreError="Unable to retrieve your company information; please reload the page",$scope.coreDataComplete=!1,$scope.editMode=!1,$scope.loading=!1})}$scope.convertToTextarea=function(event){var elem=jQuery(event.target),height=elem.height();elem.wrapAll("<textarea>");var parent=elem.parent();elem.contents().unwrap(),parent.height(height),parent.select()},this.initialize=function(){$scope.coreDataComplete=!1,$scope.editMode=!1,$scope.loading=!1,$scope.htmlInstructions=!0,$scope.shopifyInstructions=!1,$scope.coreError="Loading...",loadCoreData()},UserService.loggedIn&&!UserService.isUserEmailLogin()?(UserService.logout(),$window.location.reload()):this.initialize(),$scope.loggedIn=function(){return UserService.loggedIn},$scope.editCore=function(){$scope.editMode=!0},$scope.cancelCore=function(){$scope.editMode=!1},$scope.saveCore=function(){$scope.loading=!0,$http({method:"POST",url:"/users/partner/"+UserService.uid+".json",data:{partner:$scope.partner}}).success(function(data){$scope.partner=data,$scope.editMode=!1,$scope.partner.api_key&&$scope.partner.api_key.length>0&&($scope.coreDataComplete=!0),
$scope.coreError="",$scope.loading=!1,$location.hash("core-form")}).error(function(data){$scope.coreError=data,$scope.loading=!1})},$scope.showShopifyInstructions=function(){$scope.shopifyInstructions=!0,$scope.htmlInstructions=!1},$scope.showHtmlInstructions=function(){$scope.shopifyInstructions=!1,$scope.htmlInstructions=!0},$rootScope.$on("login-success",this.initialize)};app.controller("PartnerportalController",["$scope","$rootScope","$window","UserService","$timeout","$location","$http","Analytics",PartnerportalController])}(angular.module("GiftStarterApp")),GiftStarterApp.controller("PartnersController",["$scope","$location","$timeout",PartnersController]),GiftStarterApp.controller("PressController",["$scope","$location","$timeout",PressController]),GiftStarterApp.controller("whatIsItController",["$scope","$location","ToastService","$http","Analytics","$window",WhatIsItController]);var player;GiftStarterApp.controller("HomeController",["$scope","Analytics","$window","$http","$timeout","AppStateService","$location","ToastService","$interval","$routeParams","$rootScope","PopoverService",function($scope,Analytics,$window,$http,$timeout,AppStateService,$location,ToastService,$interval,$routeParams,$rootScope,PopoverService){function fadeInComment(){$scope.pitchinIndex+=1,$scope.fadedIn=!0,$timeout(fadeOutComment,6800)}function fadeOutComment(){$scope.fadedIn=!1}!((new Date).getTime()<1427871599e3)||device.mobile()||$window.sessionStorage.getItem("seenSweepsMarch")||$routeParams.searchTerm||$window.sessionStorage.getItem("fromSearch")||(PopoverService.setPopover("sweepstakes"),$window.sessionStorage.setItem("seenSweepsMarch","yes")),Analytics.track("client","loaded home"),AppStateService.state&&(AppStateService.state.gsid?$location.path("/giftstart").search("gs-id",AppStateService.state.gsid):AppStateService.state.createSession&&$location.path("/create")),$routeParams.resetCode&&$rootScope.$broadcast("password-reset-requested"),$routeParams.searchTerm&&$timeout(function(){$window.sessionStorage.setItem("searchTermFromUrl",$routeParams.searchTerm),$rootScope.$broadcast("performSearchFromUrl")},200),$scope.topCampaigns={},$http({method:"GET",url:"/giftstart/api/hot-campaigns?num_campaigns=2"}).success(function(data){Analytics.track("client","hot campaigns load succeeded"),$scope.topCampaigns=data;for(var j=0;j<$scope.topCampaigns.pitchins.length;j++)for(var i=0;i<$scope.topCampaigns.pitchins[j].length;i++){var image=new Image;image.src=$scope.topCampaigns.pitchins[j][i].img}}).error(function(data){Analytics.track("client","hot campaigns load failed")}),$scope.reachOutNotReadyYet=function(){Analytics.track("client","reach out not ready yet"),ToastService.setToast("Oops!  Reaching out to friends isn't quite ready yet.<br>Thanks for letting us know you're interested!",7e3)},$scope.pitchinIndex=0,$scope.fadedIn=!1,$location.search().TESTING_OMG||(fadeInComment(),$interval(fadeInComment,7e3)),$scope.goToLink=function(destination){$location.path("/"+destination)}}]),GiftStarterApp.controller("GiftsGivenBarController",["$scope","$timeout",GiftsGivenBarController]),angular.module("GiftStarterApp").directive("gsThankedCampaigns",["$http","Analytics",gsThankedCampaigns]),GiftStarterApp.directive("gsPrintUrl",["$location","$http",gsPrintUrl]),function(app){var HeaderController=function($scope,$location,UserService,Analytics,PopoverService,$rootScope,$interval,$timeout,$window,$http,$anchorScroll){function notificationsSeen(){$http({method:"POST",url:"/users/notify/"+UserService.uid+".json",data:{set_seen:"*"}})}function routeChangeListener(event,next){self.creating=0===$location.path().indexOf("/create"),self.portaling=0===$location.path().indexOf("/portal"),menuClose(),next.$$route&&(self.thisRoute=next.$$route.originalPath)}function updateSubliminal(){self.subliminalOffset-=22.8178,self.subliminalOffset<-253&&(self.subliminalOffset=-3),self.subliminalStyle={"background-position-y":self.subliminalOffset+"px"}}function closeLogin(){$scope.showBlackout=!1,$scope.showLoginwrapper=!1}function revealLogin(){$scope.showBlackout=!0,$scope.showLoginwrapper=!0}function showReset(){revealLogin(),$rootScope.$broadcast("loginbox-show-reset"),jQuery(".loginwrapper .userlogin__password").focus()}function logout(){self.userImageUrl="",Analytics.track("user","logout from header"),UserService.logout()}function updateLogin(){self.loggedIn=UserService.loggedIn,self.userImageUrl=UserService.profileImageUrl,self.userProfileUrl="/users/"+UserService.uid,self.userName=UserService.name.toUpperCase()}function loginKeyPress($event){27==$event.keyCode&&closeLogin()}function menuOpen(){$rootScope.$broadcast("menu-open")}function menuClose(){$rootScope.$broadcast("menu-close")}var self=this;this.thisRoute=$location.path().toString(),this.loggedIn=UserService.loggedIn,this.mobile=device.mobile()||device.tablet(),this.subliminalOffset=-3,this.subliminalStyle={"background-position-y":this.subliminalOffset+"px"},this.logout=logout,this.showReset=showReset,this.closeLogin=closeLogin,this.loginKeyPress=loginKeyPress,this.menuOpen=menuOpen,this.userImageUrl=UserService.profileImageUrl,this.userProfileUrl="/users/"+UserService.uid,this.userName=UserService.name.toUpperCase(),this.creating=0===$location.path().indexOf("/create"),this.portaling=0===$location.path().indexOf("/portal"),$scope.isHeaderOnly="/header"==self.thisRoute,$scope.isProvidence="/providence"==self.thisRoute,$scope.search=!1,$scope.menu=!1,$scope.notifyOpen=!1,$scope.numNotifications=0,$scope.numNotificationsUnseen=0,$scope.notifications=null,$scope.notificationHover=!1,$scope.showLoginwrapper=!1,$scope.showBlackout=!1,$interval(updateSubliminal,3e3),$scope.$on("login-success",updateLogin),$scope.$on("logout-success",updateLogin),$scope.$on("$routeChangeStart",routeChangeListener),$scope.$on("profile-image-changed",updateLogin),checkNotifications=function(){UserService.loggedIn&&$http({method:"GET",url:"/users/notify/"+UserService.uid+".json"}).success(function(response){$scope.notifications=response.notifications,$scope.numNotifications=0,$scope.numNotificationsUnseen=0;for(item in $scope.notifications)$scope.numNotifications++,$scope.notifications[parseInt(item)].seen||$scope.numNotificationsUnseen++}).error(function(response){console&&console.log&&console.log(response)})},$scope.pollNotifications=function(){checkNotifications(),$timeout($scope.pollNotifications,3e3)},$scope.pollNotifications(),self.notificationsHoverIn=function(){$scope.notificationHover=!0,notificationsSeen()},self.notificationsHoverOut=function(){$scope.notificationHover=!1},self.openNotifications=function(){$scope.notifyOpen=!0,notificationsSeen(),self.closeMobileMenu(),$scope.showBlackout=!0,$anchorScroll("notificationlist")},self.closeNotifications=function(){$scope.showBlackout=!1,$scope.notifyOpen=!1},self.notificationClick=function(item){$http({method:"POST",url:"/users/notify/"+UserService.uid+".json",data:{set_acknowledged:'["'+item.id+'"]'}}),$scope.notifications.splice($scope.notifications.indexOf(item),1),self.closeNotifications()},self.toggleMobileMenu=function(){$scope.menu=!$scope.menu},self.closeMobileMenu=function(){$scope.menu=!1},self.showLogin=function(){revealLogin(),$rootScope.$broadcast("loginbox-show-login"),$timeout(function(){$rootScope.$broadcast("loginbox-show-login")},200)};var hideMenu=device.mobile()||device.tablet();if($scope.headerSearchTerm="",$scope.actions={toggleMobileMenu:function(){hideMenu=!hideMenu,hideMenu?(device.mobile()&&olark("api.box.show"),angular.element("ul.headerNav").removeClass("expanded")):(device.mobile()&&olark("api.box.hide"),angular.element("ul.headerNav").addClass("expanded"))},menuItemClicked:function(isLoginItem){(device.mobile()||device.tablet())&&(device.mobile()&&!isLoginItem&&olark("api.box.show"),angular.element("ul.headerNav").removeClass("expanded"),hideMenu=!0)},search:function(){$window.sessionStorage.setItem("fromSearch","yes"),$location.path("/"),$timeout(function(){$rootScope.$broadcast("performSearchFromHeader")},100)}},$rootScope.$on("header-show-login",function(){self.showLogin()}),$rootScope.$on("header-close-login",function(){self.closeLogin()}),$rootScope.$on("password-reset-requested",function(){self.loggedIn?(self.logout(),window.location.reload()):$location.path("/",!1),self.showReset()}),$scope.scrollTo=function(id){$location.hash(id),$anchorScroll()},"nav_mobile"==$location.hash())$scope.menu=!0;else if("searchbar"==$location.hash())$scope.search=!0;else if("nav_login"==$location.hash())self.showLogin();else if("nav_help"==$location.hash()||"nav_start"==$location.hash()){var menuopenlistener=function(){jQuery("#"+$location.hash()).removeClass("hover"),angular.element($window).off("mousemove",menuopenlistener)};jQuery("#"+$location.hash()).addClass("hover"),angular.element($window).on("mousemove",menuopenlistener)}var producturl=decodeURIComponent($location.search().producturl);if(producturl&&""!=producturl&&"true"!=producturl&&"undefined"!=producturl){var parser=document.createElement("a");parser.href=producturl,olark("api.box.expand"),olark("api.chat.sendMessageToVisitor",{body:"Welcome!  Can I help you gift this product from "+("localhost"==parser.hostname?"another site":parser.hostname)+"?"})}var userAgent=navigator.userAgent.toLowerCase();-1!=userAgent.indexOf("safari")&&(userAgent.indexOf("chrome")>-1||userAgent.indexOf("opera")>-1||userAgent.indexOf("opr")>-1||jQuery(".menu-login > .submenu").css("margin-top","-7px"))};app.controller("HeaderController",["$scope","$location","UserService","Analytics","PopoverService","$rootScope","$interval","$timeout","$window","$http","$anchorScroll",HeaderController]).run(function($rootScope,$location,$anchorScroll,$routeParams){$rootScope.$on("$routeChangeSuccess",function(newRoute,oldRoute){$location.hash($routeParams.scrollTo),$anchorScroll()})})}(angular.module("GiftStarterApp")),function(app){var SearchController=function($scope,$location){var self=this;this.thisRoute=$location.path().toString(),$scope.isProvidence="/providence"==self.thisRoute};app.controller("SearchController",["$scope","$location",SearchController])}(angular.module("GiftStarterApp")),GiftStarterApp.service("ToastService",["$rootScope",ToastService]),GiftStarterApp.directive("gsToast",gsToast),GiftStarterApp.service("Analytics",["$window","ABChoices","$rootScope","$location",AnalyticsService]),GiftStarterApp.controller("HeadController",["$scope","$location",HeadController]),GiftStarterApp.service("UserService",["$http","$rootScope","$cookieStore","$window","$timeout","FacebookService","TwitterService","GooglePlusService","emailLoginService","Analytics",UserService]),GiftStarterApp.controller("ProfileController",["$scope","UserService","$location","Analytics",ProfileController]),function(app){var UserprofileController=function($scope,UserService,$location,$http){function imageUpdated(data){$scope.imageSet=!0,imageData=data}function submit(){UserService.uploadProfileImage(imageData).then(function(newImageUrl){$scope.user.img_url=newImageUrl.data,$scope.editMode=!1},function(reason){console&&console.log&&console.log("Failed to update profile image",reason),$scope.editMode=!1})}var urlpath=$location.path(),thisUser=urlpath.substring(urlpath.lastIndexOf("/")+1);$scope.user={},$scope.userIdea={},$scope.pitchins_unique=[],$http({method:"GET",url:"/users/profile/"+thisUser+".json?ext=giftideas"}).success(function(response){$scope.user=response,$scope.userIdea=$scope.user.giftideas}),UserService.getUser(thisUser,function(data){$scope.userCampaings=data[Object.keys(data)[0]],$scope.pitchins_unique=getUniquePitchIns($scope.userCampaings.pitchins)});var getUniquePitchIns=function(pitchins){var i,flags=[],ret=[],l=pitchins.length;for(i=0;l>i;i++)flags[pitchins[i].giftstart_url_title]||(flags[pitchins[i].giftstart_url_title]=!0,ret.push(pitchins[i]));return ret};$scope.giftstartThisUrl=function(title,price,img,url){return"/create?"+urlSerialize({product_url:url,title:title,price:price,img_url:img,source:"StoredProduct"})},$scope.DeleteSavedItem=function(idea){idea.loading=!0;var index=$scope.userIdea.indexOf(idea);$scope.userIdea.splice(index,1),$http.post("/users",{uid:$scope.user.uid,action:"delete-save-for-later",url:idea.url,retailer:idea.retailer,price:idea.price,title:idea.title,imgUrl:idea.img}).then(function(){idea.loading=!1},function(){})};var urlSerialize=function(obj){var str=[];for(var p in obj)obj.hasOwnProperty(p)&&str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")};$scope.fieldisable=!0,$scope.blocked=!0,$scope.quantity=10,$scope.campaingquantity=3,$scope.showMore=!0,$scope.showMoreCampaign=!0,$scope.imgloading=!1,$scope.months=[{label:"Jan",value:1},{label:"Feb",value:2},{label:"Mar",value:3},{label:"Apr",value:4},{label:"May",value:5},{label:"Jun",value:6},{label:"Jul",value:7},{label:"Aug",value:8},{label:"Sep",value:9},{label:"Oct",value:10},{label:"Nov",value:11},{label:"Dec",value:12}];var imageData;$scope.editable=thisUser==UserService.uid,$scope.imageSet=!1,$scope.user.error_message="",$scope.imageUpdated=imageUpdated,$scope.submit=submit,$scope.validateLinks=function(){$scope.user.link_facebook=addProtocol($scope.user.link_facebook),$scope.user.link_twitter=addProtocol($scope.user.link_twitter),$scope.user.link_linkedin=addProtocol($scope.user.link_linkedin),$scope.user.link_googleplus=addProtocol($scope.user.link_googleplus),$scope.user.link_website=addProtocol($scope.user.link_website)},$scope.$on("logout-success",function(){$scope.editable=!1});var addProtocol=function(link){return link&&(link=link.trim().toLowerCase(),""!=link&&link.indexOf("http://")<0&&link.indexOf("https://")<0&&(link="http://"+link)),link};$scope.goToLink=function(destination){$location.path("/"+destination)}};app.controller("UserprofileController",["$scope","UserService","$location","$http","Analytics",UserprofileController])}(angular.module("GiftStarterApp")),function(app){var gsUserEdit=function($http,UserService,Analytics){function link(scope,elm,attrs,userProfileform){scope.canEdit=!0,scope.editUserFields=function(){!scope.userinfo&&scope.blocked?(scope.copyUser=angular.copy(scope.user),scope.fieldisable=!1,scope.canEdit=!1):scope.userinfo&&scope.fieldisable&&(scope.copyUserInfo=angular.copy(scope.user),scope.canEdit=!1,scope.blocked=!1)},scope.cancelEdit=function(){scope.canEdit=!0,scope.user.error_message="",scope.fieldisable=!0,scope.userinfo?scope.userinfo&&scope.fieldisable&&(scope.user.name=angular.copy(scope.copyUserInfo.name),scope.user.link_facebook=angular.copy(scope.copyUserInfo.link_facebook),scope.user.link_twitter=angular.copy(scope.copyUserInfo.link_twitter),scope.user.link_linkedin=angular.copy(scope.copyUserInfo.link_linkedin),scope.user.link_googleplus=angular.copy(scope.copyUserInfo.link_googleplus),scope.user.link_website=angular.copy(scope.copyUserInfo.link_website),scope.user.birth_month=angular.copy(scope.copyUserInfo.birth_month),scope.user.birth_day=angular.copy(scope.copyUserInfo.birth_day)):(scope.user.name=angular.copy(scope.copyUser.name),scope.user.email=angular.copy(scope.copyUser.email),scope.user.shipping_address=angular.copy(scope.copyUser.shipping_address),scope.user.shipping_city=angular.copy(scope.copyUser.shipping_city),scope.user.shipping_state=angular.copy(scope.copyUser.shipping_state)),scope.blocked=!0},scope.saveInput=function(){scope.loading=!0,scope.user.error_message="",userProfileform.$valid?($http.post("/users",{uid:scope.user.uid,action:"update-profile",name:scope.user.name,email:scope.user.email,link_facebook:scope.user.link_facebook,link_twitter:scope.user.link_twitter,link_linkedin:scope.user.link_linkedin,link_googleplus:scope.user.link_googleplus,link_website:scope.user.link_website,phone:scope.user.phone,shipping_address:scope.user.shipping_address,birth_day:scope.user.birth_day,birth_month:scope.user.birth_month,shipping_city:scope.user.shipping_city,shipping_state:scope.user.shipping_state,shipping_zip:scope.user.shipping_zip}).then(function(res){scope.loading=!1},function(errorRes){scope.user.error_message="Error. Please try again.",userProfileform.$invalid=!0}),scope.canEdit=!0,scope.fieldisable=!0,scope.blocked=!0):(scope.user.error_message="It looks like some of your info is incorrect; please try again.",scope.loading=!1,scope.canEdit=!1,scope.fieldisable=!1)},scope.$on("logout-success",function(){scope.canEdit=!0,scope.fieldisable=!0,scope.blocked=!0})}return{scope:{fieldisable:"=",user:"=",userinfo:"=",blocked:"=",loading:"="},require:"^form",link:link,templateUrl:"/scripts/user/user_profile_edit.ng.html",restrict:"E"}};app.directive("gsUserEdit",["$http","UserService","Analytics",gsUserEdit])}(angular.module("GiftStarterApp")),GiftStarterApp.controller("InspirationalExamplesController",["$scope","$timeout",InspirationalExamplesController]),GiftStarterApp.service("FacebookService",["ezfb","$http","$rootScope","$location","$window","AppStateService","$q",FacebookService]),GiftStarterApp.service("TwitterService",["$http","$rootScope","$window","$location","$q","AppStateService",function($http,$rootScope,$window,$location,$q,AppStateService){function twitterOauthCallback(oauthToken,oauthVerifier){self.oauth_token=oauthToken,self.verfier=oauthVerifier,self.submitVerifier()}this.uid=-1,this.usr_img="",this.name="",this.token="",this.verifier="",this.auth_url="",this.oauth_token="";var self=this;this.login=function(){$window.open(self.auth_url,"_self")},this.logout=function(){$rootScope.$broadcast("twitter-logout-success")},this.share=function(){ga("send","event","share campaign","twitter");var shareUrl="https://twitter.com/share",parameters="?url="+encodeURIComponent($location.absUrl().split("#")[0])+"&text="+encodeURIComponent("Help us gift #together on @GiftStarter! It's easy! Simply purchase 1 or more tiles on the #gift. #GiftsMatter");$window.open(shareUrl+parameters)},this.submitVerifier=function(){$http({method:"POST",url:"/users",data:{action:"submit-verifier",service:"twitter",verifier:self.verfier,oauth_token:self.oauth_token,location:$location.path()+$window.location.search,referrer:AppStateService.referrer}}).success(function(data){self.uid=data.uid,self.name=data.name,self.usr_img=data.usr_img,self.token=data.token,self.subscribed=data.on_mailing_list,self.has_pitched_in=data.has_pitched_in,$rootScope.$broadcast("twitter-login-success")}).error(function(data){console&&console.log&&console.log(data)})},this.getAuthUrl=function(successCallback,failureCallback){var deferred=$q.defer();AppStateService.set("login_service","twitter");var doDeferred=function(){return $http({method:"POST",url:"/users",data:{action:"get-auth-url",service:"twitter",redirect_url:AppStateService.getOauthRedirectUrl()}}).success(function(data){self.auth_url=data.url,deferred.resolve(self.auth_url)}).error(function(data){console&&console.log&&console.log(data),deferred.reject(data)}),deferred.promise};return doDeferred()},this.checkSharePermission=function(){var deferred=$q.defer(),doDeferred=function(){return $http({method:"POST",url:"/users",data:{action:"has-share-auth",service:"twitter"}}).success(function(data){deferred.resolve(data)}).error(function(data){console&&console.log&&console.log(data),deferred.reject(data)}),deferred.promise};return doDeferred()},this.getSharePermissionUrl=function(){var deferred=$q.defer(),doDeferred=function(){return AppStateService.set("login_service","twitter"),$http({method:"POST",url:"/users",data:{action:"get-share-auth-url",service:"twitter",redirect_url:AppStateService.getOauthRedirectUrlForSharing()}}).success(function(data){deferred.resolve(data.url)}).error(function(data){console&&console.log&&console.log(data),deferred.reject(data)}),deferred.promise};return doDeferred()},this.doShare=function(message,link){var deferred=$q.defer(),doDeferred=function(){return $http({method:"POST",url:"/users",data:{action:"do-share",service:"twitter",link:link,message:message}}).success(function(data){deferred.resolve(data)}).error(function(data){console&&console.log&&console.log(data),deferred.reject(data)}),deferred.promise};return doDeferred()},AppStateService.oauthToken&&twitterOauthCallback(AppStateService.oauthToken,AppStateService.oauthVerifier)}]),GiftStarterApp.service("GooglePlusService",["$http","$rootScope","$window","$location","$q","AppStateService",function($http,$rootScope,$window,$location,$q,AppStateService){this.uid=-1,this.usr_img="",this.name="",this.token="";var self=this;this.loginCallback=function(authResponse){self.authResponse=authResponse,self.submitOneTimeCode()},this.submitOneTimeCode=function(){self.gplus_code_request={method:"POST",url:"/users",data:{service:"googleplus",action:"submit-one-time-code",auth_response:self.authResponse,location:$location.path()+$window.location.search,redirect_url:$window.location.protocol+"//"+$window.location.host+"/",referrer:AppStateService.referrer}},$http(self.gplus_code_request).success(function(data){self.uid=data.uid,self.name=data.name,self.usr_img=data.usr_img,self.token=data.token,self.subscribed=data.on_mailing_list,self.has_pitched_in=data.has_pitched_in,$rootScope.$broadcast("googleplus-login-success")}).error(function(data){console&&console.log&&console.log(data)}),self.loginRequested=!1},this.login=function(){AppStateService.set("login_service","googleplus"),self.auth_url="https://accounts.google.com/o/oauth2/auth?scope="+encodeURIComponent("https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/userinfo.email")+"&client_id="+encodeURIComponent($window.googlePlusClientId)+"&redirect_uri="+encodeURIComponent($window.location.protocol+"//"+$window.location.host+"/")+"&response_type=code&state="+AppStateService.base64State()+"&access_type=offline",self.auth_window=$window.open(self.auth_url,"_self"),self.loginRequested=!0},this.logout=function(){$rootScope.$broadcast("googleplus-logout-success")},this.share=function(uid){ga("send","event","share campaign","googleplus");var shareUrl="https://plus.google.com/share";$location.search("re",btoa(JSON.stringify({type:"consumer",uid:uid,channel:"googleplus",uuid:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"==c?r:3&r|8;return v.toString(16)})})));var parameters="?url="+encodeURIComponent($location.absUrl().split("#")[0]);$window.open(shareUrl+parameters),$location.search("re",null)},AppStateService.gplusAuthResponse&&self.loginCallback(AppStateService.gplusAuthResponse)}]),GiftStarterApp.service("LinkedInService",["$http","$rootScope","$window","$location","AppStateService","$q",function($http,$rootScope,$window,$location,AppStateService,$q){var self=this;this.login=function(){AppStateService.set("login_service","linkedin"),self.auth_url="https://www.linkedin.com/uas/oauth2/authorization?scope="+encodeURIComponent("r_basicprofile r_emailaddress")+"&client_id="+encodeURIComponent($window.linkedInClientId)+"&redirect_uri="+encodeURIComponent($window.location.protocol+"//"+$window.location.host)+"&response_type=code&state="+AppStateService.base64State(),self.auth_window=$window.open(self.auth_url,"_self"),self.loginRequested=!0},this.logout=function(){$rootScope.$broadcast("linkedin-logout-success")},this.checkSharePermission=function(){var deferred=$q.defer(),doDeferred=function(){return $http({method:"POST",url:"/users",data:{action:"has-share-auth",service:"linkedin"}}).success(function(data){deferred.resolve(data)}).error(function(data){console&&console.log&&console.log(data),deferred.reject(data)}),deferred.promise};return doDeferred()},this.getSharePermissionUrl=function(){AppStateService.set("login_service","linkedin");var url="https://www.linkedin.com/uas/oauth2/authorization?scope="+encodeURIComponent("r_basicprofile r_emailaddress w_share")+"&client_id="+encodeURIComponent($window.linkedInClientId)+"&redirect_uri="+encodeURIComponent($window.location.protocol+"//"+$window.location.host)+"&response_type=code&state="+AppStateService.base64StateForSharing();return url},this.doShare=function(message,link,linkName){var deferred=$q.defer(),doDeferred=function(){return $http({method:"POST",url:"/users",data:{action:"do-share",service:"linkedin",message:message,link:link,link_name:linkName}}).success(function(data){deferred.resolve(data)}).error(function(data){console&&console.log&&console.log(data),deferred.reject(data)}),deferred.promise};return doDeferred()}}]),function(app){"use strict";var EmailLoginService=function($http,$q,$rootScope){var self=this;this.uid=-1,this.usr_img="",this.name="",this.token="";var urls={create:"/login/email/create",forgotPassword:"/login/email/requestreset",login:"/login/email/login",reset:"/login/email/reset"},login=function(mode,emailname,email,password,resetCode){var deferred=$q.defer();return $http.post(urls[mode],{emailname:emailname,email:email,password:password,code:resetCode}).success(function(response){var resObj=response;if(resObj.ok){if("login"===mode){var data=resObj.ok;self.uid=data.uid,self.usr_img=data.usr_img,self.name=data.name,self.token=data.token,self.subscribed=data.on_mailing_list,self.has_pitched_in=data.has_pitched_in,$rootScope.$broadcast("email-login-success")}deferred.resolve(resObj.ok)}else deferred.reject(resObj.error)}).error(function(){deferred.reject("We are having technical problems.  Please try again later.")}),deferred.promise},logout=function(){$rootScope.$broadcast("email-logout-success")};this.login=login,this.logout=logout};app.service("emailLoginService",["$http","$q","$rootScope",EmailLoginService])}(angular.module("GiftStarterApp")),function(app){var LoginOrCreateController=function($scope,$rootScope,$location,$routeParams,$timeout,$http,AppStateService,UserService,TwitterService,FacebookService,LinkedInService,GooglePlusService,emailLoginService,Analytics){function doSocialLogin(successFunction,maxRetries){maxRetries="undefined"!=typeof maxRetries?maxRetries:3,AppStateService.get("staged_giftstart")?(console&&console.log&&console.log("staged-create: "+AppStateService.get("staged_giftstart").staging_uuid),$http.post("/giftstart/create.json",AppStateService.get("staged_giftstart")).success(function(response){AppStateService.remove("staged_giftstart"),AppStateService.setPath($location.path()),successFunction()}).error(function(){maxRetries>0&&console&&console.log&&console.log("Error while staging GiftStart; retrying..."),doSocialLogin(successFunction,maxRetries-1)})):successFunction()}$scope.working=!1,"undefined"==typeof $scope.showCreate&&($scope.showCreate=!0),$scope.showForgot=!1,$scope.showReset=!1,"undefined"==typeof $scope.showSocials&&($scope.showSocials=!0),$scope.name,$scope.surname,$scope.email,$scope.password,$scope.showPassword,$scope.message,$scope.resetCode,$scope.resetForm=function(){$scope.name="",$scope.surname="",$scope.email="",$scope.password="",$scope.showPassword=!1,$scope.message="",$scope.resetCode=""},$scope.resetForm(),UserService.loggedIn&&jQuery(".userlogin").css({display:"none"}),$scope.doLoginFacebook=function(){doSocialLogin(FacebookService.login)},$scope.doLoginTwitter=function(){doSocialLogin(function(){TwitterService.getAuthUrl().then(function(url){TwitterService.login()})})},$scope.doLoginGoogleplus=function(){doSocialLogin(GooglePlusService.login)},$scope.doLoginLinkedin=function(){doSocialLogin(LinkedInService.login)},$scope.doLoginEmail=function(){Analytics.track("user","login attempt with email"),$scope.working=!0,emailLoginService.login("login","",$scope.email,$scope.password,"").then(function(okMsg){},function(errMsg){$scope.working=!1,$scope.message=errMsg})},$scope.doCreateEmail=function(){Analytics.track("user","create email login"),$scope.working=!0,emailLoginService.login("create",$scope.name+" "+$scope.surname,$scope.email,$scope.password,"").then(function(okMsg){emailLoginService.login("login","",$scope.email,$scope.password,"")},function(errMsg){$scope.working=!1,$scope.message=errMsg})},$scope.doForgotPassword=function(){Analytics.track("user","forgot login password"),$scope.working=!0,emailLoginService.login("forgotPassword","",$scope.email,"","").then(function(okMsg){$scope.message=okMsg,$scope.showForgot=!1,$scope.working=!1},function(errMsg){$scope.message=errMsg,$scope.working=!1})},$scope.doResetPassword=function(){Analytics.track("user","reset login password"),$scope.working=!0,emailLoginService.login("reset","",$scope.email,$scope.password,$scope.resetCode).then(function(okMsg){$scope.message=okMsg,$scope.showForgot=!1,$scope.working=!1,$scope.doLoginEmail()},function(errMsg){$scope.message=errMsg,$scope.working=!1})},$scope.$on("logout-success",function(){jQuery(".userlogin").fadeIn(1500),$scope.resetForm()}),$scope.$on("hide-login-socials",function(){$scope.showSocials=!1}),$scope.$on("login-success",function(){$scope.resetForm(),$scope.message=UserService.name?"Welcome, "+UserService.name+"!":"Welcome!",$timeout(function(){$rootScope.$broadcast("header-close-login")},3e3),jQuery(".userlogin").fadeOut(3e3),$scope.working=!1}),$rootScope.$on("loginbox-show-login",function(){$scope.resetForm(),$scope.showCreate=!1,$scope.showReset=!1,setTimeout(function(){jQuery(".loginwrapper .userlogin__email").focus()},0)}),$rootScope.$on("loginbox-show-reset",function(){$scope.resetForm(),$scope.resetCode=$routeParams.resetCode,$scope.showCreate=!1,$scope.showReset=!0})};app.controller("LoginOrCreateController",["$scope","$rootScope","$location","$routeParams","$timeout","$http","AppStateService","UserService","TwitterService","FacebookService","LinkedInService","GooglePlusService","emailLoginService","Analytics",LoginOrCreateController])}(angular.module("GiftStarterApp")),GiftStarterApp.service("GiftStartService",["$http","$location","UserService","$rootScope","PopoverService","$window","Analytics","AppStateService","$resource",GiftStartService]),GiftStarterApp.controller("GiftStartController",["$scope","$rootScope","GiftStartService","$location","$interval","$timeout","FacebookService","TwitterService","GooglePlusService","Analytics","ProductService","UserService","AppStateService","$window","$document","$http","PopoverService","LocalStorage",GiftStartController]),GiftStarterApp.directive("gsCopyUrl",["$window",gsCopyUrl]),GiftStarterApp.directive("gsThanks",gsThanks),function(app){"use strict";var controller=function($scope,$rootScope,GiftStartService,$location,ProductService,UserService,PopoverService,$http,$timeout,Analytics,AppStateService){function calculateInitialNumParts(){$scope.selectedXYSet=0;for(var guess=0;guess<$scope.xySets.length;guess++){var calcPrice=$scope.inputPrice/$scope.xySets[guess][0]/$scope.xySets[guess][1];if(20.5>calcPrice)return guess}return $scope.xySets.length-1}function completePriceChange(){Analytics.track("campaign","price changed"),$scope.salesTax=$scope.salesTaxRate*$scope.inputPrice*100,$scope.serviceFee=$scope.serviceFeeRate*$scope.inputPrice*100,$scope.shipping=shippingRate*$scope.inputPrice*100,$scope.totalPrice=100*$scope.inputPrice+$scope.salesTax+$scope.serviceFee+$scope.shipping,$scope.fetchingTaxRate=!1,$scope.updateOverlay()}function stagedGiftStart(uuid){return{title:$scope.title,description:$scope.description,coupon:$scope.coupon,product_url:ProductService.product.product_url,product_img_url:$scope.selectedImg,product_price:100*$scope.inputPrice,product_title:ProductService.product.title,sales_tax:$scope.salesTax,shipping:$scope.shipping,service_fee:$scope.serviceFee,total_price:$scope.totalPrice,campaign_length:campaignLength,columns:$scope.x,rows:$scope.y,shipping_name:$scope.shippingName,shipping_email:$scope.shippingEmail,shipping_state:$scope.shippingState,shipping_zip:$scope.shippingZip,gc_email:$scope.gcEmail,staging_uuid:uuid}}function clearCreateData(){$scope.title="",$scope.description="",$scope.coupon="",$scope.selectedImg="",$scope.shippingName="",$scope.shippingEmail="",$scope.shippingZip="",$scope.shippingState="",$scope.inputPrice=0,campaignLength=10,$scope.shippingDetailsSubmitted=!1}function dateChosenValid(){return!($scope.getCampaignLength($scope.deliveryDate)>=29||$scope.getCampaignLength($scope.deliveryDate)<1);
}function resetValidationErrors(){$scope.hideValidationError={title:!0,description:!0,coupon:!0,shippingState:!0,shippingZip:!0,shippingName:!0,shippingEmail:!0,deliveryDate:!0,gcEmail:!0}}function extractReferral(){$location.search().product_url&&$location.search().title&&$location.search().price&&$location.search().img_url&&$location.search().source&&(restoreFromReferral({product_url:$location.search().product_url,productTitle:$location.search().title,productImgUrl:$location.search().img_url,price:$location.search().price,source:$location.search().source}),$location.search("product_url",null),$location.search("title",null),$location.search("price",null),$location.search("img_url",null),$location.search("source",null))}function extractPromo(){"dress-for-success"==$location.search().promo&&($scope.title="Gift a Start Collection",$scope.description="Give the gift of confidence this holiday season with this curated assortment of beautiful basics. butter LONDON is proud to partner with Dress for Success to gift a new start to women in need. Dress for Success is a not-for-profit organization dedicated to helping women get back on their feet and back into the workforce. For these women giving something as simple as a lipstick can make an impact. Help deliver a new start this holiday season by starting a GiftStart for our Gift A Start Collection.",$scope.shippingZip="98118",$scope.shippingState="WA",$scope.shippingChanged(),$location.search("promo",null))}function restoreFromReferral(referral){ProductService.product.product_url=referral.product_url,ProductService.product.title=referral.productTitle,ProductService.product.imgs=[referral.productImgUrl],$scope.selectedImg=referral.productImgUrl,$scope.inputPrice=parseInt(referral.price)/100,$scope.showIntroCopy=!0,$scope.fromReferral=!0,$scope.referredFrom=getReferrerName(referral.source),$scope.ghostruck=/ghostruck/.test(referral.source.toLowerCase()),/ghostruck/.test(referral.source.toLowerCase())&&($scope.shippingState="WA",$scope.shippingZip="98118",$scope.shippingChanged()),Analytics.track("client","referred from",referral.source)}function getReferrerName(source){return/ghostruck/.test(source.toLowerCase())?"Ghostruckers!":""}var shippingRate=0,campaignLength=10;$scope.inputPrice=ProductService.product.price/100,$scope.totalPrice=0,$scope.deliveryDate=null,$scope.campaignEndDate=null,$scope.getCampaignLength=function(date){return angular.isDate(date)&&(campaignLength=Math.round((date.getTime()-(new Date).getTime())/864e5)-5),campaignLength},$scope.salesTaxRate=.098,$scope.serviceFeeRate=.08,$scope.fetchingTaxRate=!1,$scope.xySets=[[1,2],[1,3],[2,2],[1,5],[2,3],[2,4],[3,3],[2,5],[3,4],[3,5],[4,4],[3,6],[4,5],[4,6],[5,5],[5,6],[6,6],[6,7],[7,7]],$scope.showLoginBox=!1,$scope.createStep=1,$scope.shippingName="",$scope.shippingEmail="",$scope.shippingZip="",$scope.shippingState="",$scope.shippingDetailsSubmitted=!1,$scope.product=ProductService.product,$scope.imgIndex=0,$scope.selectedImg=ProductService.product.imgs[$scope.imgIndex],$scope.title="",$scope.description="",$scope.gcEmail="",UserService.loggedIn&&UserService.getUser(UserService.uid,function(data){$scope.gcEmail=data[Object.keys(data)[0]].email}),$scope.coupon="",$scope.specialNotes="",$scope.pitchInsInitialized=!1,$scope.giftStart=GiftStartService.giftStart,$scope.descriptionLongEnough=!0,this.referral={},$scope.showIntroCopy=!1,$scope.fromReferral=!1,$scope.dateChosenValid=dateChosenValid,$scope.changeDueDate=!1,$scope.shippingChanged=function(){$scope.shippingZip&&5==$scope.shippingZip.length&&(Analytics.track("campaign","shipping updated"),$scope.fetchingTaxRate=!0,$scope.shippingDetailsSubmitted=!0,$http({method:"POST",url:"/product",data:{action:"get-tax-and-shipping",shipping_address:"street",shipping_city:"city",title:ProductService.product.title,shipping_state:$scope.shippingState,shipping_zip:$scope.shippingZip}}).success(function(result){Analytics.track("product","tax and shipping fetch success"),$scope.salesTaxRate=result.tax,$scope.fetchingTaxRate=!1,$scope.priceChanged()}).error(function(reason){$scope.fetchingTaxRate=!1,Analytics.track("product","tax and shipping fetch failed")}))},$scope.nextImage=function(){$scope.imgIndex=($scope.imgIndex+1)%$scope.product.imgs.length,$scope.selectedImg=$scope.product.imgs[$scope.imgIndex],$scope.updateGiftStartImage()},$scope.previousImage=function(){$scope.imgIndex=($scope.imgIndex+$scope.product.imgs.length-1)%$scope.product.imgs.length,$scope.selectedImg=$scope.product.imgs[$scope.imgIndex],$scope.updateGiftStartImage()},$scope.updateGiftStartImage=function(){Analytics.track("campaign","selected image changed"),GiftStartService.giftStart.product_img_url=$scope.selectedImg},$scope.priceChanged=function(){$scope.fetchingTaxRate=!0,$http({method:"POST",url:"/product",data:{action:"get-service-fee",coupon:$scope.coupon}}).success(function(result){Analytics.track("product","service fee fetch success"),$scope.serviceFeeRate=result.fee,completePriceChange()}).error(function(reason){Analytics.track("product","service fee fetch failure"),completePriceChange()})},$scope.moreParts=function(event){Analytics.track("campaign","number of parts changed"),$scope.selectedXYSet<$scope.xySets.length-1&&($scope.selectedXYSet+=1,$scope.x=$scope.xySets[$scope.selectedXYSet][0],$scope.y=$scope.xySets[$scope.selectedXYSet][1],$scope.updateOverlay()),event.preventDefault()},$scope.fewerParts=function(event){Analytics.track("campaign","number of parts changed"),$scope.selectedXYSet>0&&($scope.selectedXYSet-=1,$scope.x=$scope.xySets[$scope.selectedXYSet][0],$scope.y=$scope.xySets[$scope.selectedXYSet][1],$scope.updateOverlay()),event.preventDefault()},$scope.updateOverlay=function(){GiftStartService.giftStart.columns=$scope.x,GiftStartService.giftStart.rows=$scope.y,GiftStartService.giftStart.total_price=$scope.totalPrice,GiftStartService.giftStart.parts=GiftStartService.makeParts($scope.x*$scope.y,$scope.totalPrice),$scope.giftStart=GiftStartService.giftStart,$scope.$broadcast("overlay-updated")},$scope.makeUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"==c?r:3&r|8;return v.toString(16)})},$scope.dueDateEmpty=function(){return $(".endDate")[0].value?!1:!0},$scope.changeDeliveryDate=function(){$(".endDate").datepicker("show")},$scope.deliveryDateChanged=function(dateText){$scope.campaignEndDate=new Date($scope.deliveryDate),$scope.campaignEndDate.setDate($scope.campaignEndDate.getDate()-6),$(".endRange").datepicker("option","maxDate",$scope.campaignEndDate),$(".endRange").datepicker("setDate",$scope.campaignEndDate)};var endDateChanged=function(dateText){$scope.campaignEndDate=new Date(dateText),$(".endRange").datepicker("setDate",$scope.campaignEndDate)};$scope.validationCreateStep={title:2,description:2,coupon:3,shippingState:3,shippingZip:3,shippingName:3,shippingEmail:3,deliveryDate:3,gcEmail:2},resetValidationErrors(),$scope.isSubmittingData=!1,$scope.validationTrigger={createButtonClicked:!1},$scope.runValidation=function(){var keys=Object.keys($scope.hideValidationError),hasErrors=!1;return keys.forEach(function(key){switch($scope.validationCreateStep[key]==$scope.createStep&&($scope.hideValidationError[key]=!1),$scope.createStep){case 2:hasErrors=$scope.campaignForm.title.$error.required||$scope.campaignForm.description.$error.required||$scope.campaignForm.gcEmail.$error.required;break;case 3:hasErrors=$scope.campaignForm.shippingState.$error.required||$scope.campaignForm.shippingZip.$error.required||$scope.campaignForm.shippingName.$error.required||$scope.campaignForm.shippingEmail.$error.required||$scope.campaignForm.deliveryDate.$error.required}}),$scope.validationTrigger.createButtonClicked=!0,!hasErrors},$scope.isCreateStepTiles=function(){return 1==$scope.createStep},$scope.isCreateStepStory=function(){return 2==$scope.createStep},$scope.isCreateStepShipping=function(){return 3==$scope.createStep},$scope.goToStep=function(i){$scope.createStep=Math.max(Math.min(i,3),1),$("html,body").animate({scrollTop:$("#giftstart-create-controls").offset().top-100},500)},$scope.prevStep=function(){$scope.goToStep($scope.createStep-1)},$scope.nextStep=function(){$scope.runValidation()&&$scope.goToStep($scope.createStep+1),jQuery("#giftstart-create-next").blur()},$scope.next=function(){if($scope.runValidation(),GiftStartService.title=$scope.title,GiftStartService.description=$scope.description,GiftStartService.coupon=$scope.coupon,GiftStartService.productUrl=ProductService.product.product_url,GiftStartService.productTitle=ProductService.product.title,GiftStartService.retailerLogo=ProductService.logo,GiftStartService.productImgUrl=$scope.selectedImg,GiftStartService.rows=$scope.y,GiftStartService.columns=$scope.x,GiftStartService.productPrice=100*$scope.inputPrice,GiftStartService.shippingName=$scope.shippingName,GiftStartService.shippingEmail=$scope.shippingEmail,GiftStartService.shippingZip=$scope.shippingZip,GiftStartService.shippingState=$scope.shippingState,GiftStartService.salesTax=$scope.salesTax,GiftStartService.shipping=$scope.shipping,GiftStartService.serviceFee=$scope.serviceFee,GiftStartService.totalPrice=$scope.totalPrice,GiftStartService.campaignLength=campaignLength,GiftStartService.specialNotes=$scope.specialNotes,GiftStartService.gcEmail=$scope.gcEmail,GiftStartService.gcName=UserService.name,$scope.campaignForm.$valid&&0!=$scope.inputPrice&&dateChosenValid())if(UserService.loggedIn)Analytics.track("campaign","campaign submitted","",$scope.totalPrice),$scope.isSubmittingData=!0,GiftStartService.createGiftStart().success(function(data){clearCreateData(),resetValidationErrors()}).error(function(data){alert("A severe error occurred; please try again? If it keeps happening, please contact the Gift Concierge with the following information: "+data),$scope.isSubmittingData=!1});else{var uuid=$scope.makeUUID();AppStateService.set("staging_uuid",uuid),console&&console.log&&console.log("staging: "+stagedGiftStart(uuid).staging_uuid),AppStateService.set("staged_giftstart",stagedGiftStart(uuid)),console&&console.log&&console.log("staged: "+AppStateService.get("staged_giftstart").staging_uuid),$rootScope.$broadcast("loginbox-show-login"),$scope.showLoginBox=!0}},$scope.onDescriptionBlur=function(){var longEnough=$scope.description.length>400;!longEnough&&$scope.descriptionLongEnough?Analytics.track("campaign","description too short displayed"):longEnough&&!$scope.descriptionLongEnough&&Analytics.track("campaign","description too short hidden"),$scope.descriptionLongEnough=longEnough},GiftStartService.title?($scope.specialNotes=GiftStartService.specialNotes,$scope.giftStart=GiftStartService.giftStart):(GiftStartService.giftStart.gsid=0,GiftStartService.giftStart=GiftStartService.buildGiftStart()),$scope.selectedXYSet=calculateInitialNumParts(),extractReferral(),extractPromo(),$timeout(function(){$scope.pitchInsInitialized=!0},2500),this.referral&&($scope.selectedXYSet=calculateInitialNumParts()),$scope.x=$scope.xySets[$scope.selectedXYSet][0],$scope.y=$scope.xySets[$scope.selectedXYSet][1],$scope.updateGiftStartImage(),$scope.priceChanged(),$(".endDate").datepicker({minDate:"+7d",maxDate:"+34d",onSelect:$scope.deliveryDateChanged}),$(".endRange").datepicker({minDate:"+7d",maxDate:"+34d",onSelect:endDateChanged}),$rootScope.$on("login-success",function(){$scope.showLoginBox=!1,$scope.next()})};app.controller("GiftStartCreateController",["$scope","$rootScope","GiftStartService","$location","ProductService","UserService","PopoverService","$http","$timeout","Analytics","AppStateService",controller])}(angular.module("GiftStarterApp")),GiftStarterApp.controller("ShareController",["$scope","$rootScope","GiftStartService","$location","$interval","$timeout","FacebookService","TwitterService","GooglePlusService","LinkedInService","Analytics","ProductService","UserService","AppStateService","$window","$document","$http","PopoverService","LocalStorage",ShareController]),GiftStarterApp.service("ProductService",["$http","$rootScope","Analytics","UserService","PopoverService","$location",ProductService]),GiftStarterApp.directive("gsProductSearch",gsProductSearch),GiftStarterApp.directive("gsOverlay",gsOverlay),GiftStarterApp.service("PopoverService",["$rootScope","$timeout","Analytics","LocalStorage",PopoverService]),GiftStarterApp.directive("gsPopover",["PopoverService","$compile","$document",gsPopover]),GiftStarterApp.directive("gsFundingBar",[gsFundingBar]),GiftStarterApp.controller("LoginPopoverController",["$scope","$http","$cookieStore","UserService","PopoverService","GiftStartService","TwitterService","FacebookService","$location","GooglePlusService","Analytics","AppStateService","emailLoginService","$routeParams","$timeout",LoginPopoverController]),GiftStarterApp.directive("gsLoginPopover",function(){return{restrict:"E",templateUrl:"/scripts/popover/login/login-popover.html"}}),function(app){"use strict";var noteText="",skipNote=!1,notePopoverController=function($scope,$rootScope,$location,UserService,PopoverService,GiftStartService,Analytics){$scope.noteText=noteText,$scope.skipNote=skipNote,$scope.profilePicture=UserService.profileImageUrl,$scope.name=UserService.name,$scope.$on("pitchin-image-changed",function(event,imgUrl){$scope.profilePicture=imgUrl}),$scope.hidePopover=function(){PopoverService.hidePopover()},$scope.editPhoto=function(){noteText=$scope.noteText,skipNote=$scope.skipNote,PopoverService.setPopover("profile")},$scope.action={submit:function(){$scope.skipNote?(Analytics.track("pitchin","no note submitted"),GiftStartService.saveNote(" ",$scope.name)):(Analytics.track("pitchin","note submitted"),GiftStartService.saveNote($scope.noteText,$scope.name)),$rootScope.$broadcast("signbox-hidden"),$scope.skipNote=skipNote=!1,$scope.noteText=noteText="",$scope.name=UserService.name,$scope.profilePicture=UserService.profileImageUrl}}};app.controller("NotePopoverController",["$scope","$rootScope","$location","UserService","PopoverService","GiftStartService","Analytics",notePopoverController])}(angular.module("GiftStarterApp")),GiftStarterApp.directive("gsNotePopover",function(){return{restrict:"E",templateUrl:"/scripts/popover/note/note-popover.html"}}),function(app){"use strict";var profilePopoverController=function($scope,UserService,PopoverService,GiftStartService,Analytics){function imageUpdated(data){console&&console.log&&console.log("imageUpdated: "+data),$scope.imageSet=!0,imageData=data}function saveUpdatedImage(){$scope.useAsProfilePicture?UserService.uploadProfileImage(imageData).success(function(newImageUrl){GiftStartService.saveImage(newImageUrl),UserService.profileImageUrl=newImageUrl,$scope.$parent.$broadcast("pitchin-image-changed",newImageUrl),$scope.$parent.$broadcast("profile-image-changed",newImageUrl)}).error(function(reason){console&&console.log&&console.log("Failed to update profile image",reason)}):GiftStartService.uploadImage(imageData).success(function(newImageUrl){GiftStartService.saveImage(newImageUrl),$scope.$parent.$broadcast("pitchin-image-changed",newImageUrl)}).error(function(reason){console&&console.log&&console.log("Failed to update pitch-in image",reason)})}$scope.profilePicture=UserService.profileImageUrl,$scope.useAsProfilePicture=!1,$scope.editMode=!1,$scope.user=UserService.user;var imageData;$scope.imageSet=!1,$scope.imageUpdated=imageUpdated,$scope.userHasDefaultProfileImage=!1,UserService.isSystemDefaultProfileImage(UserService.uid,function(data){$scope.userHasDefaultProfileImage=data}),$scope.cancel=function(){PopoverService.hidePopover()},$scope.action={submit:function(){$scope.imageSet?(saveUpdatedImage(),Analytics.track("pitchin","user pitchin image "+($scope.useAsProfilePicture?"and profile image ":"")+"changed"),PopoverService.hidePopover()):(Analytics.track("pitchin","user image not changed"),PopoverService.hidePopover()),$scope.editMode=!1}}};app.controller("ProfilePopoverController",["$scope","UserService","PopoverService","GiftStartService","Analytics",profilePopoverController])}(angular.module("GiftStarterApp")),GiftStarterApp.directive("gsProfilePopover",function(){return{restrict:"E",templateUrl:"/scripts/popover/profile/profile-popover.html"}}),GiftStarterApp.controller("PayPopoverController",["$scope","$rootScope","GiftStartService","PopoverService","UserService","Analytics","CardService","$timeout",PayPopoverController]),GiftStarterApp.directive("gsPayPopover",function(){return{restrict:"E",templateUrl:"/scripts/popover/pay/pay-popover.html"}}),angular.module("GiftStarterApp").service("CardService",["$rootScope","$http","UserService","Analytics",cardService]),GiftStarterApp.controller("ThanksPopoverController",["$scope","PopoverService","GiftStartService","UserService","FacebookService","TwitterService","GooglePlusService","Analytics",ThanksPopoverController]),GiftStarterApp.directive("gsThanksPopover",function(){return{restrict:"E",templateUrl:"/scripts/popover/thanks/thanks-popover.html"}}),function(app){"use strict";var emailSharePopoverController=function($scope,PopoverService,$http,UserService,Analytics,GiftStartService,$location){var emails,email=/^[a-z0-9!#$%&'*+/=?^_`{|}~.-]+@[a-z0-9-]+\.([a-z0-9-]+)+$/i,trackEmailClientClick=function(){Analytics.track("client","email client share clicked")},sendEmail=function(to,from,message,share_url){Analytics.track("campaign","email share submitted"),$scope.sending=!0,$http({method:"PUT",url:"/giftstart/share",data:{to:to,from:from,message:message,share_url:share_url,gsid:GiftStartService.giftStart.gsid,sender_name:UserService.name,sender_uid:UserService.uid}}).success(function(){Analytics.track("campaign","email share succeeded"),$scope.sending=!1,$scope.toEmails="",$scope.fromEmail="",$scope.message="",$scope.hidePopover()}).error(function(){$scope.sending=!1,Analytics.track("campaign","email share failed")})};$scope.toEmails="",$scope.fromEmail=UserService.email,$scope.userSvcName=UserService.name,$scope.gsName=GiftStartService.giftStart.title,$scope.formValid=!0,$scope.message="I thought you might be interested in pitching in on this GiftStarter campaign:",$scope.formValid=!0,$scope.emailUrl="mailto:?subject="+encodeURI("Join us on a gift together")+"&body="+encodeURI("I thought you might be interested in pitching in on this GiftStarter campaign:\n\n"+$location.absUrl()),$scope.sending=!1,$scope.hidePopover=PopoverService.hidePopover,$scope.trackEmailClientClick=trackEmailClientClick,$scope.submit=function(){emails=$scope.toEmails.replace(/[ \n]/g,"").split(/[,;]/).filter(function(eml){return""!==eml}),$scope.formValid=emails.length>0&&emails.every(function(s){return email.test(s)})&&email.test($scope.fromEmail),$scope.formValid&&($location.search("re",btoa(JSON.stringify({type:"consumer",uid:UserService.uid,channel:"email",uuid:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"==c?r:3&r|8;return v.toString(16)})}))),sendEmail(emails,$scope.fromEmail,$scope.message,$location.absUrl()),$location.search("re",null))}};app.controller("EmailSharePopoverController",["$scope","PopoverService","$http","UserService","Analytics","GiftStartService","$location",emailSharePopoverController])}(angular.module("GiftStarterApp")),GiftStarterApp.directive("gsEmailSharePopover",function(){return{restrict:"E",templateUrl:"/scripts/popover/email-share/email-share-popover.html"}}),function(app){var sweepStakesDirective=function($http,PopoverService){var link=function(scope,element,attr){scope.model={first:"",last:"",email:"",message:""},scope.close=function(){PopoverService.hidePopover()},scope.submit=function(){scope.sweepForm.$valid&&$http.post("/users/sweepstakes.json",{firstname:scope.model.first,lastname:scope.model.last,email:scope.model.email}).success(function(res){scope.model.message=res.ok,PopoverService.hidePopover()}).error(function(res){scope.model.message=res.error})}};return{restrict:"E",scope:{},link:link,templateUrl:"/scripts/popover/sweepstakes/sweepstakes-popover.html"}};app.directive("gsSweepstakesPopover",["$http","PopoverService",sweepStakesDirective])}(angular.module("GiftStarterApp")),GiftStarterApp.controller("StaffPicksController",["$scope","$timeout",StaffPicksController]),GiftStarterApp.directive("gsImageUpload",gsImageUpload),GiftStarterApp.service("LocalStorage",["$window",LocalStorage]),UserVoice=window.UserVoice||[],function(){var uv=document.createElement("script");uv.type="text/javascript",uv.async=!0,uv.src="//widget.uservoice.com/N48EEGX3xi555mzpZNQw.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(uv,s)}(),UserVoice.push(["set",{accent_color:"#e23a39",trigger_color:"white",trigger_background_color:"#df484b"}]),UserVoice.push(["identify",{}]),UserVoice.push(["autoprompt",{}]),function(){function clampDirective($timeout){function linkDirective(scope,element,attrs){$timeout(function(){var lineCount=1,lineMax=+attrs.clamp,lineStart=0,lineEnd=0,text=element.html().replace(/\n/g," "),maxWidth=element[0].offsetWidth,estimateTag=createElement();element.empty(),element.append(estimateTag),text.replace(/ /g,function(m,pos){lineCount>=lineMax||(estimateTag.html(text.slice(lineStart,pos)),estimateTag[0].offsetWidth>maxWidth&&(estimateTag.html(text.slice(lineStart,lineEnd)),resetElement(estimateTag),lineCount++,lineStart=lineEnd+1,estimateTag=createElement(),element.append(estimateTag)),lineEnd=pos)}),estimateTag.html(text.slice(lineStart)),resetElement(estimateTag,!0),scope.$emit("clampCallback",element,attrs)})}var directive={restrict:"A",link:linkDirective};return directive}function createElement(){var tagDiv=document.createElement("div");return function(s){s.position="absolute",s.whiteSpace="pre",s.visibility="hidden",s.display="inline-block"}(tagDiv.style),angular.element(tagDiv)}function resetElement(element,type){element.css({position:"inherit",overflow:"hidden",display:"block",textOverflow:type?"ellipsis":"clip",visibility:"inherit",whiteSpace:"nowrap",width:"100%"})}GiftStarterApp.directive("clamp",clampDirective),clampDirective.$inject=["$timeout"]}(),angular.module("GiftStarterApp").directive("gsItButton",["GiftStartService",gsItButton]),angular.module("GiftStarterApp").directive("gsItHeader",["$interval","$window","$location","Analytics",gsItHeader]),angular.module("GiftStarterApp").directive("gsSubscribeHeader",["$location","Analytics","$timeout","UserService",gsSubscribeHeader]);