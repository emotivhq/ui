<div class="giftstart wrapper" ng-controller="GiftStartController" >

    <div class="fullwidth block">
        <div class="title">
            <h1 class="title campaign-title" ng-hide="editMode">{{giftStart.title}}</h1>
            <input class="title" ng-model="newTitle" ng-show="editMode"/>
            <span class="title edit"></span>
        </div>
    </div>

    <div class="fullwidth block">

        <div class="col2 block" ng-hide="showLoginBox||showPayBox||showSignBox||showShareBox">
            <div class="prodtitle">
                <a ng-href="{{giftStart.product_url}}" rel="nofollow" class="title" target="_blank" ng-click="productLinkClicked();" ng-mouseover="hideOverlay();" ng-mouseleave="showOverlay();" ng-show="giftStart.product_title">{{giftStart.product_title}}</a>
            </div>
            <div class="description">
                <span class="description edit"><textarea class="description" ng-model="newDescription" ng-show="editMode"></textarea></span>
                <span class="description makelinks" ng-hide="editMode" style="white-space: pre-line;">{{giftStart.description}}</span>
            </div>
            <div class="signature">
                <p class="name" ng-show="!editMode">
                    <span class="signature__title" ng-show=" giftStart.gc_name "> {{ giftStart.gc_name }} </span>
                </p>
                    <input class="gc-name" ng-model="newGcName" ng-show="editMode"/>
                <a class="edit button linky" ng-show="campaignEditable && !editMode && secondsLeft > 0 && !campaignComplete()" ng-click="editMode=true;">EDIT</a>
                <div class="save"><button class="save" ng-click="updateCampaign();" ng-show="editMode">Save</button><button class="save" ng-click="editMode=false;" ng-show="editMode">X</button></div>
                <p ng-show="giftStart.gc_name.length > 0 || editMode" class="gift-champion">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gift Champion</p>
            </div>
        </div>
        <div class="overlay block" Xng-class="{shrunk: showPayBox}">
            <div class="image-upload" ng-show="editMode"><label>Upload New Image:  </label><input id="campaign-image-input" type="file" capture="camera" accept="image/*"/></div>
            <gs-overlay ng-class="{initialized: pitchInsInitialized}" giftstart="giftStart" ng-click="selectionUpdated();"></gs-overlay>
            <div class="receipt-wrap" ng-show="showPayBox">
                <div class="receipt">
                    <div class="receipt-tiles">
                        <div class="img-wrap" style="background-image:url('{{giftStart.product_img_url}}')"></div>
                        <div class="info-tiles">
                            <h2 class="num-tiles">{{giftStart.nSelected}} PIECES</h2>
                            <h4 class="cost-tiles">AT ${{getTileCost() / 100 | number : 2}} EACH</h4>
                        </div>
                    </div>
                    <div class="receipt-total">
                        <h4 class="purchase-total">PURCHASE TOTAL: <h2 class="total-price">${{giftStart.totalSelection / 100 | number : 2}}</h2></h4>
                        <p class="purchase-note">Includes our gift concierge service, taxes, shipping, handling, and handmade card.</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="login-box" ng-show="showLoginBox">
            <h2>Log in or create an account:</h2>
            <ng-include src="'/scripts/login/login-or-create.html'"></ng-include>
        </div>
        <div class="pay-box" ng-show="showPayBox">
            <h2>Payment Information:</h2>
            <p>We accept payment by Visa, MasterCard, Amex, or Discover.  Our payments are secure and processed by PayPal.</p>
            <ng-include src="'/scripts/pay/pay.html'"></ng-include>
        </div>
        <div class="sign-box" ng-show="showSignBox">
            <h2>Sign the Card:</h2>
            <p>Write a message to the recipient and we'll include it on the group card so they'll know part of this gift came from you. You know, giving credit where credit is due. Weâ€™re all about that.</p>
            <ng-include src="'/scripts/popover/note/note-popover.html'"></ng-include>
        </div>
        <div class="share-box" ng-show="showShareBox">
            <h2>Share with Friends:</h2>
            <p>Your payment was successful! Thank you. You will receive an email shorty. In the meantime, you can invite friends to pitch in just like you did.</p>
            <a href="#share-panel"><button class="pitch-in button green" ng-click="showSharePanel(true)" ng-hide="showShare"><span>INVITE FRIENDS TO PITCH IN</span></button></a>
            <a href="" ng-click="shareBox(false)">SKIP THIS STEP</a>
        </div>

        <!--ng-include src="'/scripts/share/invite-pitchin.html'"></ng-include-->

        <div class="col2 block" ng-hide="showLoginBox||showPayBox||showSignBox||showShareBox">
            <div class="pitch-instructions" ng-show="secondsLeft > 0 && !campaignComplete()">
                <div class="ordinal_circle"><span class="ordinal">1</span></div><h4> CLICK ON THE PIECES YOU WANT TO PURCHASE</h4><br/>
                <div class="ordinal_circle"><span class="ordinal">2</span></div><h4> PITCH IN!</h4>
            </div>
            <button class="pitch-in button red" ng-show="secondsLeft > 0 && !campaignComplete()" ng-class="{disabled: giftStart.totalSelection == 0}" ng-click="pitchIn()" ng-mouseover="pitchInHoverCallback()" title="{{pitchinButtonHoverMessage}}">PAY ${{giftStart.totalSelection / 100 | number : 2}} NOW</button>

            <div class="giftstart-this" ng-show="secondsLeft <= 0 || campaignComplete()">
                Would you like to give this gift to someone you know?  Click the button below to start your own campaign for this gift.<br/>
                <a class="giftstart-this-link" target="_self" href="{{giftstartThisUrl()}}"><button class="pitch-in button primary">GIFTSTART IT</button></a>
                <div class="saveforlater">
                    <button class="pitch-in button green" ng-click="saveProdForLater();">SAVE FOR LATER <img ng-show="isSavingForLater" class="loader" src="/assets/loading_transparent.gif"></button>
                    <div class="product-message" ng-bind-html="productMessage"></div>
                </div>
            </div>

            <a href="#share-panel"><button class="pitch-in button green" ng-click="showSharePanel(true)" ng-hide="showShare"><span ng-hide="secondsLeft <= 0 || campaignComplete()">INVITE FRIENDS TO PITCH IN</span><span ng-show="secondsLeft <= 0 || campaignComplete()">SHARE THIS CAMPAIGN</span></button></a>
            <!--div class="invite block">
                <h3 class="black invite-friends">Share This Campaign With Friends!</h3>
                <img class="share" src="/assets/envelope.png" ng-click="emailShare();" />
                <img class="share" src="/assets/facebookicon.png" ng-click="facebookShare();"/>
                <img class="share" src="/assets/twittericon.png" ng-click="twitterShare();" />
                <img class="share" src="/assets/googleicon.png" ng-click="googlePlusShare();" /><br/>
                Or share this link:
                <input id="share-url" type="text" value="{{campaignUrl()}}" gs-copy-url readonly/>
            </div-->
        </div>
    </div>

    <div class="fullwidth block fullwidth--last">
        <div class="prices block">
            <gs-funding-bar></gs-funding-bar>
            <div class="price funded">
                <h2><span class="giftstart product contribution">{{giftStart.nBought}}</span> Pieces</h2>
                <h4>Funded</h4>
            </div>
            <div class="price remaining">
                <h2><span class="giftstart product remaining">{{giftStart.nTotal-giftStart.nBought}}</span> Pieces</h2>
                <h4>Remaining</h4>
            </div>
        </div>
        <div class="completion block">
            <div><h4>Time Left in Campaign:</h4></div>
            <div><h2 class="countdown" ng-class="{danger: (secondsLeft < 86400) && (secondsLeft <= 0)}">{{countdown}}</h2></div>
        </div>
    </div>

    <div id="share-panel">
        <a id="closebtn" href="" ng-show="showShare" ng-click="showSharePanel(false)">CLOSE</a>
        <ng-include src="'/scripts/share/invite-pitchin.html'" ng-show="showShare"></ng-include>
    </div>

    <gs-thanks></gs-thanks>
    <div class="groupcard">
        <div class="title title--groupcard">
            <h2 class="title__name">Group Card</h2>
            <span class="title__catchline">To sign the card, first pitch-in by purchasing some pieces above</span>
        </div>
        <div ng-repeat-start="pitchIn in pitchIns | orderBy:'-timestamp' track by $index" ng-class="{true: 'contributors--row'}[$index % 3 == 0 && !$first]" class="contributors--pre h--hide"></div>
        <div class="contributors {{randomColor($index)}}">
            <div class="contributors__titleblock {{randomColor($index)}}"></div>
            <div class="contributors__figure">
                <a class="contributors__link" ng-href="/users/{{pitchIn.uid}}" ng-hide="isEditing(pitchIn) && picEdit">
                    <img class="contributors__img" ng-src="{{pitchIn.img}}" />
                </a>
                <a class="userprofile__imageedit button" ng-show="isEditing(pitchIn) && !picEdit" ng-click="setPicEdit(true)">Change photo</a>
                <gs-image-upload ng-show="isEditing(pitchIn) && picEdit" on-image-updated="imageUpdated"></gs-image-upload>
                <a class="userprofile__imagesave button" ng-click="picSubmit()" ng-show="isEditing(pitchIn) && picEdit">Save</a>
            </div>
            <div class="contributors__info">
                <h4 class="contributors__name" ng-show="!isEditing(pitchIn)">{{pitchIn.name}}</h4>
                <input type="text" ng-model="pitchIn.name" ng-show="isEditing(pitchIn)"/>
                <p class="contributors__info" ng-show="!isEditing(pitchIn)">{{pitchIn.note}}</p>
                <textarea ng-model="pitchIn.note" ng-show="isEditing(pitchIn)"/>
            </div>
            <div class="contributors__edit">
                <a class="contributors__edit__button button" ng-show="pitchIn.uid == userId && !isEditing(pitchIn) && commentEditing.length == 0" ng-click="editingComment(pitchIn, true)">EDIT</a>
                <a class="contributors__edit__button button" ng-show="isEditing(pitchIn)" ng-click="cancelEditComment(pitchIn)">CANCEL</a>
                <button class="contributors__edit__button savebtn red" ng-show="isEditing(pitchIn)" ng-disabled="picUploading" ng-click="editingComment(pitchIn, false)">SAVE</button>
            </div>
        </div>
        <div ng-repeat-end class="h--hide"></div>
        <p class="nocontributors" ng-hide="pitchIns.length > 0">No contributors yet - be the first one on the card!</p>
    </div>
    <div ng-show="campaignComplete()" class="btn btn--pdf">
        <a href="" ng-click="toPDFPage()" class="btn__link">
            View Card PDF
        </a>
    </div>
</div>
